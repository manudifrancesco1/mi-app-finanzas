(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[405],{8312:function(e,t,a){(window.__NEXT_P=window.__NEXT_P||[]).push(["/",function(){return a(9297)}])},9263:function(e,t,a){"use strict";a.d(t,{O:function(){return r}});var s=a(8590);let l="https://dbuxsnccinjldvxiooye.supabase.co",n="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImRidXhzbmNjaW5qbGR2eGlvb3llIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDk4NTM4NTgsImV4cCI6MjA2NTQyOTg1OH0.Td7-Z8AY9b_EGrbZ_Taxeif0LMkDQ1sQiOL2GU5S5tI";console.log("Supabase URL:",l),console.log("Supabase ANON KEY:",n.slice(0,10)+"…");let r=(0,s.eI)(l,n);console.log("\uD83D\uDEF0️  Supabase Client URL:",l),console.log("\uD83D\uDD11  Supabase Client Key:",n.slice(0,8)+"…")},9297:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return u}});var s=a(5893),l=a(1163),n=a(7294),r=a(9263);function c(){let e=(0,l.useRouter)(),t=async()=>{await r.O.auth.signOut(),e.push("/login")};return(0,s.jsx)("button",{onClick:t,className:"fixed top-4 right-4 bg-red-600 text-white px-3 py-1 rounded",children:"Cerrar sesi\xf3n"})}let i=n.forwardRef(function(e,t){let{title:a,titleId:s,...l}=e;return n.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:t,"aria-labelledby":s},l),a?n.createElement("title",{id:s},a):null,n.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4.5 10.5 12 3m0 0 7.5 7.5M12 3v18"}))}),o=n.forwardRef(function(e,t){let{title:a,titleId:s,...l}=e;return n.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:t,"aria-labelledby":s},l),a?n.createElement("title",{id:s},a):null,n.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19.5 13.5 12 21m0 0-7.5-7.5M12 21V3"}))});var d=a(5615),u=()=>{let e=(0,l.useRouter)(),[t,a]=(0,n.useState)(null),[u,m]=(0,n.useState)(!1),[x,h]=(0,n.useState)(()=>{let e=new Date;return"".concat(e.getFullYear(),"-").concat(String(e.getMonth()+1).padStart(2,"0"))}),[f,g]=(0,n.useState)([]),[p,j]=(0,n.useState)(0),[b,N]=(0,n.useState)(0),[w,y]=(0,n.useState)([]),[S,v]=(0,n.useState)(0),[O,_]=(0,n.useState)([]),[E,I]=(0,n.useState)(0),[L,k]=(0,n.useState)({}),[D,C]=(0,n.useState)({}),A=e=>C(t=>({...t,[e]:!t[e]}));if((0,n.useEffect)(()=>{(async()=>{let{data:{session:t}}=await r.O.auth.getSession();t?a(!0):e.replace("/mi-app-finanzas/login")})();let{data:t}=r.O.auth.onAuthStateChange((t,a)=>{a||e.replace("/mi-app-finanzas/login")});return()=>t.subscription.unsubscribe()},[e]),(0,n.useEffect)(()=>{t&&(async()=>{m(!0);let{data:{session:e}}=await r.O.auth.getSession();if(!e)return;let t=e.user.id,[a,s]=x.split("-").map(Number),l="".concat(a,"-").concat(String(s).padStart(2,"0"),"-01"),n=new Date(a,s,0).getDate(),c="".concat(a,"-").concat(String(s).padStart(2,"0"),"-").concat(n),{data:i}=await r.O.from("incomes").select("category:category_id(name),amount").eq("user_id",t).gte("date",l).lte("date",c),o={};null==i||i.forEach(e=>{var t;let a=e.category,s=Array.isArray(a)?null===(t=a[0])||void 0===t?void 0:t.name:null==a?void 0:a.name;o[s||"–"]=(o[s||"–"]||0)+e.amount});let d=o["Devoluci\xf3n"]||0;delete o["Devoluci\xf3n"];let u=Object.entries(o).map(e=>{let[t,a]=e;return{name:t,total:a}});g(u),j(u.reduce((e,t)=>e+t.total,0)),N(d);let{data:h}=await r.O.from("transactions").select("category:category_id(name),subcategory:subcategory_id(name),amount,expense_mode").eq("user_id",t).gte("date",l).lte("date",c),f={},p={},b={};null==h||h.forEach(e=>{var t,a,s;let l=Array.isArray(e.category)?null===(t=e.category[0])||void 0===t?void 0:t.name:null===(a=e.category)||void 0===a?void 0:a.name;if("fixed"===e.expense_mode)f[l]=(f[l]||0)+e.amount;else{p[l]=(p[l]||0)+e.amount;let t=e.subcategory,a=Array.isArray(t)?null===(s=t[0])||void 0===s?void 0:s.name:null==t?void 0:t.name;a&&(b[l]=b[l]||{},b[l][a]=(b[l][a]||0)+e.amount)}});let w=e=>Object.entries(e).map(e=>{let[t,a]=e;return{name:t,total:a}}),S=w(f);y(S),v(S.reduce((e,t)=>e+t.total,0));let O=w(p);_(O),I(O.reduce((e,t)=>e+t.total,0));let E={};Object.entries(b).forEach(e=>{let[t,a]=e;return E[t]=w(a)}),k(E),m(!1)})()},[x,t]),null===t)return null;let M=p-(S+(E-b));return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(c,{}),(0,s.jsxs)("main",{className:"p-4 grid gap-4 grid-cols-1 sm:grid-cols-2 lg:grid-cols-3",children:[(0,s.jsxs)("section",{className:"bg-white rounded-2xl shadow-md p-6 flex flex-col",children:[(0,s.jsxs)("header",{className:"flex items-center mb-4",children:[(0,s.jsx)(i,{className:"h-6 w-6 text-green-500 mr-2"}),(0,s.jsx)("h3",{className:"text-lg font-semibold",children:"Ingresos"})]}),(0,s.jsxs)("p",{className:"text-3xl font-bold mb-4",children:["$",p.toLocaleString()]}),(0,s.jsxs)("ul",{className:"space-y-2 flex-1 overflow-auto",children:[f.map(e=>(0,s.jsxs)("li",{className:"flex justify-between text-sm",children:[(0,s.jsx)("span",{className:"truncate",children:e.name}),(0,s.jsxs)("span",{children:["$",e.total.toLocaleString()]})]},e.name)),b>0&&(0,s.jsxs)("li",{className:"flex justify-between text-sm text-red-600",children:[(0,s.jsx)("span",{children:"Devoluciones"}),(0,s.jsxs)("span",{children:["-$",b.toLocaleString()]})]})]})]}),(0,s.jsxs)("section",{className:"bg-white rounded-2xl shadow-md p-6 flex flex-col",children:[(0,s.jsxs)("header",{className:"flex items-center mb-4",children:[(0,s.jsx)(o,{className:"h-6 w-6 text-red-500 mr-2"}),(0,s.jsx)("h3",{className:"text-lg font-semibold",children:"Gastos Fijos"})]}),(0,s.jsxs)("p",{className:"text-3xl font-bold mb-4",children:["$",S.toLocaleString()]}),(0,s.jsx)("ul",{className:"space-y-2 flex-1 overflow-auto",children:w.map(e=>(0,s.jsxs)("li",{className:"flex justify-between text-sm",children:[(0,s.jsx)("span",{className:"truncate",children:e.name}),(0,s.jsxs)("span",{children:["$",e.total.toLocaleString()]})]},e.name))})]}),(0,s.jsxs)("section",{className:"bg-white rounded-2xl shadow-md p-6 flex flex-col",children:[(0,s.jsxs)("header",{className:"flex items-center mb-4",children:[(0,s.jsx)(o,{className:"h-6 w-6 text-orange-500 mr-2"}),(0,s.jsx)("h3",{className:"text-lg font-semibold",children:"Gastos Variables"})]}),(0,s.jsxs)("p",{className:"text-3xl font-bold mb-4",children:["$",E.toLocaleString()]}),(0,s.jsx)("ul",{className:"space-y-2 flex-1 overflow-auto",children:O.map(e=>(0,s.jsxs)("li",{children:[(0,s.jsxs)("button",{onClick:()=>A(e.name),className:"w-full flex justify-between text-sm py-1",children:[(0,s.jsx)("span",{className:"truncate",children:e.name}),(0,s.jsxs)("span",{children:["$",e.total.toLocaleString()]})]}),D[e.name]&&L[e.name]&&(0,s.jsx)("ul",{className:"pl-4 space-y-1",children:L[e.name].map(e=>(0,s.jsxs)("li",{className:"flex justify-between text-xs",children:[(0,s.jsx)("span",{className:"truncate italic",children:e.name}),(0,s.jsxs)("span",{children:["$",e.total.toLocaleString()]})]},e.name))})]},e.name))})]}),(0,s.jsxs)("section",{className:"bg-white rounded-2xl shadow-md p-6 sm:col-span-2 lg:col-span-1 flex flex-col",children:[(0,s.jsxs)("header",{className:"flex items-center mb-4",children:[(0,s.jsx)(d.Z,{className:"h-6 w-6 text-blue-500 mr-2"}),(0,s.jsx)("h3",{className:"text-lg font-semibold",children:"Balance"})]}),(0,s.jsxs)("p",{className:"text-4xl font-bold ".concat(M<0?"text-red-600":"text-green-600"),children:["$",M.toLocaleString()]})]})]})]})}}},function(e){e.O(0,[590,888,774,179],function(){return e(e.s=8312)}),_N_E=e.O()}]);