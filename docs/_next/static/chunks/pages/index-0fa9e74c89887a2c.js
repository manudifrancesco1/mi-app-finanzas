(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[405],{8312:function(e,t,a){(window.__NEXT_P=window.__NEXT_P||[]).push(["/",function(){return a(8722)}])},8722:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return j}});var r=a(5893),l=a(1163),s=a(7294),n=a(9263),i=a(3962),o=a(5076);let c=s.forwardRef(function(e,t){let{title:a,titleId:r,...l}=e;return s.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:t,"aria-labelledby":r},l),a?s.createElement("title",{id:r},a):null,s.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.75 19.5 8.25 12l7.5-7.5"}))}),d=s.forwardRef(function(e,t){let{title:a,titleId:r,...l}=e;return s.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:t,"aria-labelledby":r},l),a?s.createElement("title",{id:r},a):null,s.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m8.25 4.5 7.5 7.5-7.5 7.5"}))}),u=s.forwardRef(function(e,t){let{title:a,titleId:r,...l}=e;return s.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:t,"aria-labelledby":r},l),a?s.createElement("title",{id:r},a):null,s.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 4.5v15m7.5-7.5h-15"}))}),m=s.forwardRef(function(e,t){let{title:a,titleId:r,...l}=e;return s.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:t,"aria-labelledby":r},l),a?s.createElement("title",{id:r},a):null,s.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 12h14"}))});var x=a(5615);let g=s.forwardRef(function(e,t){let{title:a,titleId:r,...l}=e;return s.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:t,"aria-labelledby":r},l),a?s.createElement("title",{id:r},a):null,s.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4.5 10.5 12 3m0 0 7.5 7.5M12 3v18"}))}),h=s.forwardRef(function(e,t){let{title:a,titleId:r,...l}=e;return s.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:t,"aria-labelledby":r},l),a?s.createElement("title",{id:r},a):null,s.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19.5 13.5 12 21m0 0-7.5-7.5M12 21V3"}))}),p=e=>e.toLocaleString("es-AR",{minimumFractionDigits:2,maximumFractionDigits:2}),f=e=>{let[t,a]=e.split("-").map(Number),r=new Date(t,a-1,1).toLocaleString("es-AR",{month:"long"});return r.charAt(0).toUpperCase()+r.slice(1)},b=e=>{let{value:t,negative:a,className:l}=e;return(0,r.jsxs)("span",{className:"tabular-nums ".concat(a?"text-red-600":""," ").concat(l||""),children:[a?"-":"","$",p(t)]})};var j=()=>{let e=(0,l.useRouter)(),[t,a]=(0,s.useState)(null),[p,j]=(0,s.useState)(!1),[w,v]=(0,s.useState)(()=>{let e=new Date;return"".concat(e.getFullYear(),"-").concat(String(e.getMonth()+1).padStart(2,"0"))}),[N,y]=(0,s.useState)([]),[k,S]=(0,s.useState)(0),[_,E]=(0,s.useState)(0),[C,O]=(0,s.useState)([]),[D,L]=(0,s.useState)(0),[M,A]=(0,s.useState)([]),[F,R]=(0,s.useState)(0),[q,B]=(0,s.useState)({}),[W,I]=(0,s.useState)({}),[T,Z]=(0,s.useState)(!1),[z,G]=(0,s.useState)(!1),U=e=>I(t=>({...t,[e]:!t[e]})),V=async()=>{try{await n.O.auth.signOut(),e.replace("/login")}catch(e){}};if((0,s.useEffect)(()=>{(async()=>{let{data:{session:t}}=await n.O.auth.getSession();t?a(!0):e.replace("/login")})();let{data:t}=n.O.auth.onAuthStateChange((t,a)=>{a||e.replace("/login")});return()=>t.subscription.unsubscribe()},[e]),(0,s.useEffect)(()=>{t&&(async()=>{j(!0);let{data:{session:e}}=await n.O.auth.getSession();if(!e)return;let t=e.user.id,[a,r]=w.split("-").map(Number),l="".concat(a,"-").concat(String(r).padStart(2,"0"),"-01"),s=new Date(a,r,0).getDate(),i="".concat(a,"-").concat(String(r).padStart(2,"0"),"-").concat(s),{data:o}=await n.O.from("incomes").select("category:category_id(name),amount").eq("user_id",t).gte("date",l).lte("date",i),c={};null==o||o.forEach(e=>{var t;let a=e.category,r=Array.isArray(a)?null===(t=a[0])||void 0===t?void 0:t.name:null==a?void 0:a.name;c[r||"–"]=(c[r||"–"]||0)+e.amount});let d=c["Devoluci\xf3n"]||0;delete c["Devoluci\xf3n"];let u=Object.entries(c).map(e=>{let[t,a]=e;return{name:t,total:a}}).sort((e,t)=>t.total-e.total);y(u),S(u.reduce((e,t)=>e+t.total,0)),E(d);let{data:m}=await n.O.from("transactions").select("category:category_id(name),subcategory:subcategory_id(name),amount,expense_mode").eq("user_id",t).gte("date",l).lte("date",i),x={},g={},h={},p=new Set(["Tarjeta Visa","Tarjeta Master"]);null==m||m.forEach(e=>{var t,a,r;let l=Array.isArray(e.category)?null===(t=e.category[0])||void 0===t?void 0:t.name:null===(a=e.category)||void 0===a?void 0:a.name;if("fixed"===e.expense_mode)p.has(l)||(x[l]=(x[l]||0)+e.amount);else{g[l]=(g[l]||0)+e.amount;let t=e.subcategory,a=Array.isArray(t)?null===(r=t[0])||void 0===r?void 0:r.name:null==t?void 0:t.name;a&&(h[l]=h[l]||{},h[l][a]=(h[l][a]||0)+e.amount)}});let f=e=>Object.entries(e).map(e=>{let[t,a]=e;return{name:t,total:a}}),b=f(x).sort((e,t)=>t.total-e.total);O(b),L(b.reduce((e,t)=>e+t.total,0));let v=f(g).sort((e,t)=>t.total-e.total);A(v),R(v.reduce((e,t)=>e+t.total,0));let N={};Object.entries(h).forEach(e=>{let[t,a]=e;return N[t]=f(a).sort((e,t)=>t.total-e.total)}),B(N),j(!1)})()},[w,t]),null===t)return null;let Y=k-(D+(F-_));return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("nav",{className:"fixed top-0 left-0 right-0 z-50 shadow-md bg-white",children:(0,r.jsx)("div",{className:"mx-auto max-w-screen-md px-3 py-2 flex flex-col gap-2 sm:flex-row sm:items-center sm:justify-center",children:(0,r.jsxs)("div",{className:"flex items-center justify-center gap-3",children:[(0,r.jsx)("button",{"aria-label":"Mes anterior",className:"p-2 rounded-full hover:bg-gray-100 active:scale-95 transition",onClick:()=>{let[e,t]=w.split("-").map(Number),a=new Date(e,t-2,1);v("".concat(a.getFullYear(),"-").concat(String(a.getMonth()+1).padStart(2,"0")))},children:(0,r.jsx)(c,{className:"h-5 w-5 text-gray-700"})}),(0,r.jsx)("span",{className:"text-xl sm:text-2xl font-bold tracking-tight",children:f(w)}),(0,r.jsx)("button",{"aria-label":"Mes siguiente",className:"p-2 rounded-full hover:bg-gray-100 active:scale-95 transition",onClick:()=>{let[e,t]=w.split("-").map(Number),a=new Date(e,t,1);v("".concat(a.getFullYear(),"-").concat(String(a.getMonth()+1).padStart(2,"0")))},children:(0,r.jsx)(d,{className:"h-5 w-5 text-gray-700"})})]})})}),(0,r.jsxs)("div",{className:"pt-16",children:[T&&(0,r.jsx)(i.Z,{onClose:()=>Z(!1),onSaved:()=>{Z(!1)}}),z&&(0,r.jsx)(o.Z,{onClose:()=>G(!1),onSaved:()=>{G(!1)}}),(0,r.jsxs)("div",{className:"fixed right-4 bottom-24 sm:bottom-28 z-40 flex flex-col gap-3",children:[(0,r.jsx)("button",{onClick:()=>G(!0),"aria-label":"Nuevo ingreso",className:"w-14 h-14 rounded-full bg-green-500 text-white shadow-xl ring-1 ring-black/5 hover:bg-green-600 active:scale-95 transition flex items-center justify-center",children:(0,r.jsx)(u,{className:"w-7 h-7"})}),(0,r.jsx)("button",{onClick:()=>Z(!0),"aria-label":"Nuevo gasto",className:"w-14 h-14 rounded-full bg-red-500 text-white shadow-xl ring-1 ring-black/5 hover:bg-red-600 active:scale-95 transition flex items-center justify-center",children:(0,r.jsx)(m,{className:"w-7 h-7"})})]}),(0,r.jsxs)("main",{className:"p-4 pb-24 grid gap-4 grid-cols-1 sm:grid-cols-2 lg:grid-cols-3",children:[(0,r.jsxs)("section",{className:"bg-white rounded-2xl shadow-sm p-6 flex flex-col",children:[(0,r.jsxs)("header",{className:"flex items-center mb-4",children:[(0,r.jsx)(x.Z,{className:"h-6 w-6 text-blue-500 mr-2"}),(0,r.jsx)("h3",{className:"text-lg font-semibold",children:"Balance"})]}),(0,r.jsx)("p",{className:"text-4xl font-bold ".concat(Y<0?"text-red-600":"text-green-600"),children:(0,r.jsx)(b,{value:Y})})]}),(0,r.jsxs)("section",{className:"bg-white rounded-2xl shadow-sm p-6 flex flex-col",children:[(0,r.jsxs)("header",{className:"flex items-center mb-4",children:[(0,r.jsx)(g,{className:"h-6 w-6 text-green-500 mr-2"}),(0,r.jsx)("h3",{className:"text-lg font-semibold",children:"Ingresos"})]}),(0,r.jsx)("p",{className:"text-3xl font-bold mb-4",children:(0,r.jsx)(b,{value:k})}),(0,r.jsxs)("ul",{className:"divide-y space-y-1",children:[N.map(e=>(0,r.jsxs)("li",{className:"py-1 flex justify-between text-sm",children:[(0,r.jsx)("span",{children:e.name}),(0,r.jsx)(b,{className:"text-right",value:e.total})]},e.name)),_>0&&(0,r.jsxs)("li",{className:"py-1 flex justify-between text-sm text-red-600",children:[(0,r.jsx)("span",{children:"Devoluciones"}),(0,r.jsx)(b,{className:"text-right",value:_,negative:!0})]})]})]}),(0,r.jsxs)("section",{className:"bg-white rounded-2xl shadow-sm p-6 flex flex-col",children:[(0,r.jsxs)("header",{className:"flex items-center mb-4",children:[(0,r.jsx)(h,{className:"h-6 w-6 text-red-500 mr-2"}),(0,r.jsx)("h3",{className:"text-lg font-semibold",children:"Gastos Fijos"})]}),(0,r.jsx)("p",{className:"text-3xl font-bold mb-4",children:(0,r.jsx)(b,{value:D})}),(0,r.jsx)("ul",{className:"divide-y space-y-1",children:C.map(e=>(0,r.jsxs)("li",{className:"py-1 flex justify-between text-sm",children:[(0,r.jsx)("span",{children:e.name}),(0,r.jsx)(b,{className:"text-right",value:e.total})]},e.name))})]}),(0,r.jsxs)("section",{className:"bg-white rounded-2xl shadow-sm p-6 flex flex-col",children:[(0,r.jsxs)("header",{className:"flex items-center mb-4",children:[(0,r.jsx)(h,{className:"h-6 w-6 text-orange-500 mr-2"}),(0,r.jsx)("h3",{className:"text-lg font-semibold",children:"Gastos Variables"})]}),(0,r.jsx)("p",{className:"text-3xl font-bold mb-4",children:(0,r.jsx)(b,{value:F})}),(0,r.jsx)("ul",{className:"divide-y space-y-1",children:M.map(e=>(0,r.jsxs)("li",{children:[(0,r.jsxs)("button",{onClick:()=>U(e.name),className:"w-full flex justify-between text-sm py-1",children:[(0,r.jsx)("span",{children:e.name}),(0,r.jsx)(b,{className:"text-right",value:e.total})]}),W[e.name]&&q[e.name]&&(0,r.jsx)("ul",{className:"pl-4 space-y-1",children:q[e.name].map(e=>(0,r.jsxs)("li",{className:"flex justify-between text-xs py-1",children:[(0,r.jsx)("span",{className:"italic",children:e.name}),(0,r.jsx)(b,{className:"text-right",value:e.total})]},e.name))})]},e.name))})]})]}),(0,r.jsx)("div",{className:"py-3 text-center",children:(0,r.jsx)("button",{onClick:V,className:"text-gray-400 text-xs underline",children:"Cerrar sesi\xf3n"})})]})]})}},5076:function(e,t,a){"use strict";var r=a(5893),l=a(9263),s=a(7294);let n=e=>e.trim().toLowerCase(),i=e=>{let t=new Set,a=[];for(let r of e){let e=n(r.name);t.has(e)||(t.add(e),a.push(r))}return a.sort((e,t)=>e.name.localeCompare(t.name,"es"))},o=e=>Number(String(e).replace(/[^0-9.,-]/g,"").replace(/\.(?=.*,)/g,"").replace(",",".")),c=e=>{let t="number"==typeof e?e:o(e);return isFinite(t)?new Intl.NumberFormat("es-AR",{minimumFractionDigits:2,maximumFractionDigits:2}).format(t):""},d="mf_income_last_category_id";t.Z=function(e){var t,a;let{onClose:u,onSaved:m,initial:x,income:g}=e,h=g?{id:g.id,amount:String(g.amount),date:g.date,description:g.description,category_id:null!==(t=g.category_id)&&void 0!==t?t:void 0}:void 0,p=null!=x?x:h,[f,b]=(0,s.useState)(()=>{let e;if(p)return p;try{let t=localStorage.getItem(d);t&&(e=Number(t))}catch(e){}return{amount:"",date:"",description:"",category_id:e}}),[j,w]=(0,s.useState)([]),[v,N]=(0,s.useState)(!1),[y,k]=(0,s.useState)(""),S=async()=>{let{data:{user:e},error:t}=await l.O.auth.getUser();if(t||!e){console.error("No hay usuario para cargar categor\xedas:",t);return}let{data:a,error:r}=await l.O.from("categories").select("id, name").eq("user_id",e.id).order("name",{ascending:!0});r?console.error("Error cargando categor\xedas:",r):w(i(a||[]))};(0,s.useEffect)(()=>{S()},[]);let _=async()=>{if(!(null==p?void 0:p.id)||!window.confirm("\xbfEst\xe1s seguro de eliminar este ingreso?"))return;let{error:e}=await l.O.from("incomes").delete().eq("id",p.id);e?(console.error(e),alert("Error al eliminar el ingreso")):m()},E=async e=>{let t;e.preventDefault();let{data:{user:a},error:r}=await l.O.auth.getUser();if(r||!a)return console.error("No se pudo obtener el usuario autenticado:",r),alert("Error interno: no hay usuario autenticado");let s=f.category_id;if(v&&y.trim()){let e=y.trim(),t=n(e),{data:r,error:i}=await l.O.from("categories").select("id, name").eq("user_id",a.id).ilike("name",e);if(i)return console.error("Error buscando categor\xeda existente:",i),alert("Error buscando categor\xeda existente");let o=(r||[]).find(e=>n(e.name)===t);if(o)s=o.id;else{let{data:t,error:r}=await l.O.from("categories").insert({name:e,user_id:a.id}).select("id, name").single();if(r||!t)return console.error("Error al crear categor\xeda:",r),alert("Error al crear categor\xeda");s=t.id}await S(),N(!1),k("")}let i={amount:o(f.amount),date:f.date,description:f.description,category_id:s,user_id:a.id};s&&b(e=>({...e,category_id:s})),(null==p?void 0:p.id)?{error:t}=await l.O.from("incomes").update(i).eq("id",p.id):{error:t}=await l.O.from("incomes").insert(i),t?(console.error("Error al guardar ingreso:",t),alert("Error al guardar el ingreso")):m()};return(0,r.jsx)("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:(0,r.jsxs)("div",{className:"bg-white w-full max-w-md max-h-[90vh] rounded-lg overflow-hidden flex flex-col",children:[(0,r.jsx)("div",{className:"px-4 pt-4 pb-2 border-b",children:(0,r.jsx)("h2",{className:"text-lg font-semibold",children:(null==p?void 0:p.id)?"Editar ingreso":"Nuevo ingreso"})}),(0,r.jsx)("div",{className:"flex-1 overflow-auto px-4 py-3",children:(0,r.jsxs)("form",{id:"income-form",onSubmit:E,className:"space-y-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block mb-1",children:"Monto"}),(0,r.jsxs)("div",{className:"flex items-center border rounded px-2",children:[(0,r.jsx)("span",{className:"text-gray-500 mr-2",children:"$"}),(0,r.jsx)("input",{type:"text",inputMode:"decimal",value:f.amount,onChange:e=>{let t=e.target.value.replace(/[^0-9.,-]/g,"");b({...f,amount:t})},onBlur:()=>b(e=>({...e,amount:c(e.amount)})),placeholder:"0,00",className:"w-full py-2 outline-none",required:!0})]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block mb-1",children:"Fecha"}),(0,r.jsx)("input",{type:"date",value:f.date,onChange:e=>b({...f,date:e.target.value}),className:"w-full border rounded px-3 py-2",required:!0})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block mb-1",children:"Categor\xeda"}),(0,r.jsxs)("select",{value:v?"__new":null!==(a=f.category_id)&&void 0!==a?a:"",onChange:e=>{if("__new"===e.target.value)N(!0),k(""),b({...f,category_id:void 0});else{let t=Number(e.target.value);N(!1),b({...f,category_id:t});try{localStorage.setItem(d,String(t))}catch(e){}}},className:"w-full border rounded px-3 py-2",children:[(0,r.jsx)("option",{value:"",children:"– Sin categor\xeda –"}),i(j).map(e=>(0,r.jsx)("option",{value:e.id,children:e.name},e.id)),(0,r.jsx)("option",{value:"__new",children:"+ Agregar nueva categor\xeda"})]})]}),v&&(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block mb-1",children:"Nueva categor\xeda"}),(0,r.jsx)("input",{type:"text",value:y,onChange:e=>k(e.target.value),placeholder:"Nombre de nueva categor\xeda",className:"w-full border rounded px-3 py-2",required:!0})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block mb-1",children:"Descripci\xf3n (opcional)"}),(0,r.jsx)("input",{type:"text",value:f.description,onChange:e=>b({...f,description:e.target.value}),placeholder:"Descripci\xf3n",className:"w-full border rounded px-3 py-2"})]})]})}),(0,r.jsxs)("div",{className:"px-4 py-3 border-t bg-white flex gap-2 justify-end",children:[(null==p?void 0:p.id)&&(0,r.jsx)("button",{type:"button",onClick:_,className:"px-3 py-2 border rounded text-red-600",children:"Eliminar"}),(0,r.jsx)("button",{type:"button",onClick:u,className:"px-4 py-2 border rounded",children:"Cancelar"}),(0,r.jsx)("button",{form:"income-form",type:"submit",className:"px-4 py-2 bg-green-600 text-white rounded",children:"Guardar"})]})]})})}}},function(e){e.O(0,[590,962,888,774,179],function(){return e(e.s=8312)}),_N_E=e.O()}]);