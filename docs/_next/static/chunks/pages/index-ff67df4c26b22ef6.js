(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[405],{8312:function(e,t,a){(window.__NEXT_P=window.__NEXT_P||[]).push(["/",function(){return a(3790)}])},9263:function(e,t,a){"use strict";a.d(t,{O:function(){return u}});var n=a(8590);let r="https://dbuxsnccinjldvxiooye.supabase.co",o="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImRidXhzbmNjaW5qbGR2eGlvb3llIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDk4NTM4NTgsImV4cCI6MjA2NTQyOTg1OH0.Td7-Z8AY9b_EGrbZ_Taxeif0LMkDQ1sQiOL2GU5S5tI";console.log("Supabase URL:",r),console.log("Supabase ANON KEY:",o.slice(0,10)+"…");let u=(0,n.eI)(r,o);console.log("\uD83D\uDEF0️  Supabase Client URL:",r),console.log("\uD83D\uDD11  Supabase Client Key:",o.slice(0,8)+"…")},3790:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return s}});var n,r=a(5893),o=a(7294),u=a(9263),i=a(1163);function l(){let e=(0,i.useRouter)(),t=async()=>{await u.O.auth.signOut(),e.push("/login")};return(0,r.jsx)("button",{onClick:t,className:"fixed top-4 right-4 bg-red-600 text-white px-3 py-1 rounded",children:"Cerrar sesi\xf3n"})}var s=(n=()=>{let[e,t]=(0,o.useState)(()=>{let e=new Date;return"".concat(e.getFullYear(),"-").concat(String(e.getMonth()+1).padStart(2,"0"))}),[a,n]=(0,o.useState)([]),[i,s]=(0,o.useState)(0),[c,d]=(0,o.useState)(0),[m,g]=(0,o.useState)([]),[p,f]=(0,o.useState)(0),[S,y]=(0,o.useState)([]),[b,v]=(0,o.useState)(0),[h,_]=(0,o.useState)({}),[O,I]=(0,o.useState)({});return(0,o.useEffect)(()=>{(async()=>{let{data:{session:t},error:a}=await u.O.auth.getSession();if(a||!t)return;let r=t.user.id,[o,i]=e.split("-").map(Number),l="".concat(o,"-").concat(String(i).padStart(2,"0"),"-01"),c=new Date(o,i,0).getDate(),m="".concat(o,"-").concat(String(i).padStart(2,"0"),"-").concat(c),{data:p,error:S}=await u.O.from("incomes").select("category:category_id(name),amount").eq("user_id",r).gte("date",l).lte("date",m);if(!S&&p){let e={};p.forEach(t=>{var a,n,r;let o=t.category,u=Array.isArray(o)?null!==(n=null===(a=o[0])||void 0===a?void 0:a.name)&&void 0!==n?n:"–":null!==(r=null==o?void 0:o.name)&&void 0!==r?r:"–";e[u]=(e[u]||0)+t.amount});let t=e["Devoluci\xf3n"]||0;delete e["Devoluci\xf3n"];let a=Object.entries(e).map(e=>{let[t,a]=e;return{name:t,total:a}}).sort((e,t)=>t.total-e.total);n(a),s(a.reduce((e,t)=>e+t.total,0)),d(t)}let{data:b,error:h}=await u.O.from("transactions").select("category:category_id(name),subcategory:subcategory_id(name),amount,expense_mode").eq("user_id",r).gte("date",l).lte("date",m);if(!h&&b){let e={},t={},a={};b.forEach(n=>{var r,o,u,i;let l=n.category,s=Array.isArray(l)?null!==(o=null===(r=l[0])||void 0===r?void 0:r.name)&&void 0!==o?o:"–":null!==(u=null==l?void 0:l.name)&&void 0!==u?u:"–";if("fixed"===n.expense_mode)e[s]=(e[s]||0)+n.amount;else{t[s]=(t[s]||0)+n.amount;let e=n.subcategory,r=Array.isArray(e)?null===(i=e[0])||void 0===i?void 0:i.name:null==e?void 0:e.name;r&&(a[s]=a[s]||{},a[s][r]=(a[s][r]||0)+n.amount)}});let n=e=>Object.entries(e).map(e=>{let[t,a]=e;return{name:t,total:a}}).sort((e,t)=>t.total-e.total),r=n(e);g(r),f(r.reduce((e,t)=>e+t.total,0));let o=n(t);y(o),v(o.reduce((e,t)=>e+t.total,0));let u={};Object.entries(a).forEach(e=>{let[t,a]=e;u[t]=n(a)}),_(u)}})()},[e]),(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(l,{}),(0,r.jsx)("main",{className:"p-4 space-y-8"})]})},function(e){let t=(0,i.useRouter)(),[a,l]=(0,o.useState)(!0);return((0,o.useEffect)(()=>{(async()=>{let{data:{session:e}}=await u.O.auth.getSession();e?l(!1):t.replace("/login")})()},[t]),a)?(0,r.jsx)("div",{className:"p-10 text-center",children:"Cargando..."}):(0,r.jsx)(n,{...e})})}},function(e){e.O(0,[590,888,774,179],function(){return e(e.s=8312)}),_N_E=e.O()}]);