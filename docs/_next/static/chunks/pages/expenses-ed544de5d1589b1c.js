(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[689],{8448:function(e,t,a){(window.__NEXT_P=window.__NEXT_P||[]).push(["/expenses",function(){return a(6511)}])},6511:function(e,t,a){"use strict";a.r(t);var n=a(5893),r=a(7294),s=a(9263),i=a(3962);t.default=()=>{let[e,t]=(0,r.useState)([]),[a,l]=(0,r.useState)(null),[o,d]=(0,r.useState)("variable"),[c,u]=(0,r.useState)(!1),[m,g]=(0,r.useState)(null),[x,p]=(0,r.useState)(""),[y,h]=(0,r.useState)({}),[b,f]=(0,r.useState)([]),[v,j]=(0,r.useState)({}),w=["Alquiler","Expensas","Gas","Luz","Telefono + Internet","OSDE","Gimnasio","Tarjeta Visa","Tarjeta Master"],_=async e=>{var t,a;let{data:n}=await s.O.auth.getSession(),r=null===(t=n.session)||void 0===t?void 0:t.user.id;if(!r)return null;let{data:i,error:l}=await s.O.from("categories").select("id").eq("user_id",r).eq("name",e).maybeSingle();if(!l&&(null==i?void 0:i.id))return i.id;let{data:o,error:d}=await s.O.from("categories").insert({name:e,user_id:r,is_fixed:!0}).select("id").single();return d?(console.error(d),null):null!==(a=null==o?void 0:o.id)&&void 0!==a?a:null},N=async(e,t,a,n)=>{var r,i;let l=parseFloat(a.replace(",","."));if(!l||isNaN(l)||l<=0)return;let{data:{session:o}}=await s.O.auth.getSession();if(!o)return;let d=await _(t);if(!d)return;let c={user_id:o.user.id,amount:l,date:"".concat(e,"-01"),description:null!==(r=null==n?void 0:n.description)&&void 0!==r?r:"",category_id:d,subcategory_id:null!==(i=null==n?void 0:n.subcategory_id)&&void 0!==i?i:null,expense_mode:"fixed"};if(null==n?void 0:n.id){let{error:e}=await s.O.from("transactions").update(c).eq("id",n.id);if(e){console.error(e);return}}else{let{error:e}=await s.O.from("transactions").insert(c);if(e){console.error(e);return}}let u="".concat(e,"__").concat(t);h(e=>({...e,[u]:""})),j(e=>({...e,[u]:!1})),await k()},k=async()=>{l(null);let{data:{session:e},error:a}=await s.O.auth.getSession();if(a){console.error(a),l(a.message);return}if(!e)return;let n=e.user.id,{data:r,error:i}=await s.O.from("transactions").select("\n        id,\n        amount,\n        date,\n        description,\n        category_id,\n        subcategory_id,\n        expense_mode,\n        payment_type,\n        category:category_id(name),\n        subcategory:subcategory_id(name)\n      ").eq("user_id",n).order("date",{ascending:!1});i?(console.error(i),l(i.message)):r&&t(r.map(e=>{var t,a,n,r,s,i,l,o;let d=e.category,c=e.subcategory,u=Array.isArray(d)?null!==(n=null===(t=d[0])||void 0===t?void 0:t.name)&&void 0!==n?n:"":null!==(r=null==d?void 0:d.name)&&void 0!==r?r:"",m=Array.isArray(c)?null!==(s=null===(a=c[0])||void 0===a?void 0:a.name)&&void 0!==s?s:null:null!==(i=null==c?void 0:c.name)&&void 0!==i?i:null;return{id:e.id,amount:e.amount,date:e.date,description:e.description,category_id:e.category_id,subcategory_id:e.subcategory_id,expense_mode:null!==(l=e.expense_mode)&&void 0!==l?l:"variable",payment_type:null!==(o=e.payment_type)&&void 0!==o?o:null,category:{name:u},subcategory:m?{name:m}:null}}))};(0,r.useEffect)(()=>{k()},[]);let S=e.filter(e=>e.expense_mode===o).filter(e=>{var t,a,n;let r=x.toLowerCase();return[e.date,e.category.name,null!==(a=null===(t=e.subcategory)||void 0===t?void 0:t.name)&&void 0!==a?a:"",null!==(n=e.description)&&void 0!==n?n:""].join(" ").toLowerCase().includes(r)}),C=e=>new Intl.NumberFormat("es-AR",{minimumFractionDigits:2,maximumFractionDigits:2}).format(e),O=e=>{let t=e.match(/^(\d{4})-(\d{2})/);if(t)return{y:parseInt(t[1],10),m:parseInt(t[2],10)};let a=new Date(e);return{y:a.getFullYear(),m:a.getMonth()+1}},A=["enero","febrero","marzo","abril","mayo","junio","julio","agosto","septiembre","octubre","noviembre","diciembre"],E=e=>{let{y:t,m:a}=O(e);return"".concat(t,"-").concat(String(a).padStart(2,"0"))},F=e=>{let{y:t,m:a}=O(e),n=A[a-1]||"",r=n.charAt(0).toUpperCase()+n.slice(1);return"".concat(r," ").concat(t)},D=e=>F("".concat(e,"-15")),M=e=>{let[t,a]=e.split("-"),n=parseInt(t,10),r=parseInt(a,10);return(r+=1)>12&&(r=1,n+=1),"".concat(n,"-").concat(String(r).padStart(2,"0"))},I=(()=>{let e=new Map;for(let t of S){let a=E(t.date);e.has(a)||e.set(a,{key:a,label:F(t.date),items:[]}),e.get(a).items.push(t)}let t=Array.from(e.values());return t.forEach(e=>e.items.sort((e,t)=>e.date<t.date?1:-1)),t.sort((e,t)=>e.key<t.key?1:-1),t})(),T=(()=>{let e={};for(let t of I)"fixed"===o?e[t.key]=t.items.filter(e=>w.includes(e.category.name)).reduce((e,t)=>e+(t.amount||0),0):e[t.key]=t.items.reduce((e,t)=>e+(t.amount||0),0);return e})(),q=(()=>{let e=new Map;for(let t of I)e.set(t.key,t);for(let t of b)e.has(t)||e.set(t,{key:t,label:D(t),items:[]});let t=Array.from(e.values());return t.sort((e,t)=>e.key<t.key?1:-1),t})(),G=(()=>{let e={};for(let t of q){let a=w.map(e=>{let a=t.items.find(t=>t.category.name===e);return{category:e,paid:!!a,tx:a}});e[t.key]=a}return e})();return(0,n.jsxs)("main",{className:"p-4",children:[(0,n.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,n.jsx)("h1",{className:"text-2xl font-bold",children:"Gastos"}),(0,n.jsxs)("div",{className:"flex items-center gap-2",children:[(0,n.jsxs)("div",{className:"bg-gray-100 rounded-full p-1",children:[(0,n.jsx)("button",{className:"px-3 py-1 rounded-full text-sm ".concat("variable"===o?"bg-white shadow":""),onClick:()=>d("variable"),children:"Variables"}),(0,n.jsx)("button",{className:"px-3 py-1 rounded-full text-sm ".concat("fixed"===o?"bg-white shadow":""),onClick:()=>d("fixed"),children:"Fijos"})]}),"variable"===o&&(0,n.jsx)("button",{onClick:()=>{let e=new Date,t=e.getFullYear(),a=String(e.getMonth()+1).padStart(2,"0"),n=String(e.getDate()).padStart(2,"0");g({amount:"",date:"".concat(t,"-").concat(a,"-").concat(n),description:"",category_id:null,subcategory_id:null,new_category:"",new_subcategory:""}),u(!0)},className:"px-4 py-2 bg-red-500 hover:bg-red-600 text-white rounded-full shadow-sm transition",children:"+ Agregar Gasto"}),"fixed"===o&&(0,n.jsx)("button",{onClick:()=>{let e=M(q.length>0?q[0].key:(()=>{let e=new Date,t=e.getFullYear(),a=e.getMonth()+1;return"".concat(t,"-").concat(String(a).padStart(2,"0"))})());f(t=>t.includes(e)?t:[e,...t])},className:"px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-full shadow-sm transition",children:"Nuevo mes"})]})]}),(0,n.jsx)("div",{className:"mb-4",children:(0,n.jsx)("input",{type:"text",value:x,onChange:e=>p(e.target.value),placeholder:"Filtrar por fecha, categor\xeda, subcategor\xeda o descripci\xf3nâ€¦",className:"w-full px-3 py-2 border rounded shadow-sm focus:outline-none focus:ring"})}),a&&(0,n.jsx)("p",{className:"text-red-600 mb-4",children:a}),(0,n.jsx)("div",{className:"space-y-6",children:q.map(e=>{var t;return(0,n.jsxs)("section",{children:[(0,n.jsxs)("header",{className:"flex items-center justify-between mb-2",children:[(0,n.jsx)("h2",{className:"text-lg font-semibold",children:e.label}),(0,n.jsxs)("div",{className:"flex items-center gap-3 text-sm",children:[(0,n.jsxs)("span",{className:"text-gray-500 hidden sm:inline",children:[e.items.length," ",1===e.items.length?"movimiento":"movimientos"]}),(0,n.jsxs)("span",{className:"font-medium",children:["Total: $",C(null!==(t=T[e.key])&&void 0!==t?t:0)]})]})]}),"fixed"===o?(0,n.jsx)("div",{children:(0,n.jsx)("ul",{className:"space-y-2",children:G[e.key].map(t=>{var a;let r="".concat(e.key,"__").concat(t.category),s=null!==(a=y[r])&&void 0!==a?a:"",i=!0===v[r];return(0,n.jsxs)("li",{className:"grid grid-cols-[1fr_auto_auto] gap-2 items-center p-3 bg-white rounded shadow-sm",children:[(0,n.jsx)("span",{className:"truncate",children:t.category}),(0,n.jsx)("span",{className:"flex justify-end mr-0",children:t.paid&&!i?(0,n.jsxs)("span",{className:"inline-block w-28 text-right font-medium",children:["$",C(t.tx.amount)]}):(0,n.jsx)("input",{type:"number",inputMode:"decimal",placeholder:"Monto",value:s,onChange:e=>h(t=>({...t,[r]:e.target.value})),className:"w-28 px-2 py-1 border rounded text-right"})}),(0,n.jsx)("div",{className:"flex items-center justify-end gap-2",children:t.paid?i?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("button",{onClick:()=>N(e.key,t.category,s||String(t.tx.amount),t.tx),disabled:!s&&!(t.tx&&t.tx.amount),className:"px-3 py-1 rounded text-sm bg-blue-600 text-white hover:bg-blue-700 disabled:opacity-50",children:"Guardar"}),(0,n.jsx)("button",{onClick:()=>{j(e=>({...e,[r]:!1})),h(e=>({...e,[r]:""}))},className:"px-3 py-1 rounded text-sm bg-gray-200 text-gray-700 hover:bg-gray-300",children:"Cancelar"})]}):(0,n.jsx)("button",{onClick:()=>{j(e=>({...e,[r]:!0})),h(e=>({...e,[r]:String(t.tx.amount)}))},className:"px-3 py-1 rounded text-sm bg-gray-200 text-gray-700 hover:bg-gray-300",children:"Editar"}):(0,n.jsx)("button",{onClick:()=>N(e.key,t.category,s,t.tx),disabled:!s,className:"px-3 py-1 rounded text-sm bg-blue-600 text-white hover:bg-blue-700 disabled:opacity-50",children:"Pagar"})})]},"".concat(e.key,"-").concat(t.category))})})}):(0,n.jsx)("ul",{className:"space-y-2",children:e.items.map(e=>{var t;return(0,n.jsxs)("li",{onClick:()=>{var t;g({id:e.id,category_id:e.category_id,subcategory_id:e.subcategory_id,amount:String(e.amount),date:e.date,description:e.description||"",new_category:e.category.name,new_subcategory:(null===(t=e.subcategory)||void 0===t?void 0:t.name)||""}),u(!0)},className:"cursor-pointer flex justify-between p-3 bg-white rounded shadow-sm hover:bg-gray-50 transition",children:[(0,n.jsx)("span",{className:"flex-1 flex items-center gap-2",children:e.category.name}),(0,n.jsx)("span",{className:"flex-1",children:(null===(t=e.subcategory)||void 0===t?void 0:t.name)||"-"}),(0,n.jsx)("span",{className:"flex-1",children:e.description||"-"}),(0,n.jsx)("span",{className:"w-24 text-center",children:"credito"===e.payment_type?(0,n.jsx)("span",{className:"px-2 py-0.5 rounded-full bg-blue-600 text-white text-xs",children:"Cr\xe9dito"}):"debito"===e.payment_type?(0,n.jsx)("span",{className:"px-2 py-0.5 rounded-full bg-green-600 text-white text-xs",children:"D\xe9bito"}):"-"}),(0,n.jsxs)("span",{className:"w-24 text-right",children:["$",C(e.amount)]})]},e.id)})})]},e.key)})}),c&&(0,n.jsxs)("div",{className:"fixed inset-0 z-50 flex items-center justify-center",children:[(0,n.jsx)("div",{className:"absolute inset-0 bg-black/40",onClick:()=>u(!1)}),(0,n.jsx)("div",{className:"relative bg-white w-full max-w-md rounded-lg shadow-lg",children:(0,n.jsx)(i.Z,{initial:m||void 0,onClose:()=>u(!1),onSaved:()=>{u(!1),k(),p("")},onDelete:()=>{u(!1),k(),p("")}})})]})]})}}},function(e){e.O(0,[590,962,888,774,179],function(){return e(e.s=8448)}),_N_E=e.O()}]);