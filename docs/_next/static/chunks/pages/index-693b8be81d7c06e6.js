(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[405],{8312:function(e,t,a){(window.__NEXT_P=window.__NEXT_P||[]).push(["/",function(){return a(1044)}])},9263:function(e,t,a){"use strict";a.d(t,{O:function(){return r}});var s=a(8590);let n="https://dbuxsnccinjldvxiooye.supabase.co",l="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImRidXhzbmNjaW5qbGR2eGlvb3llIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDk4NTM4NTgsImV4cCI6MjA2NTQyOTg1OH0.Td7-Z8AY9b_EGrbZ_Taxeif0LMkDQ1sQiOL2GU5S5tI";console.log("Supabase URL:",n),console.log("Supabase ANON KEY:",l.slice(0,10)+"…");let r=(0,s.eI)(n,l);console.log("\uD83D\uDEF0️  Supabase Client URL:",n),console.log("\uD83D\uDD11  Supabase Client Key:",l.slice(0,8)+"…")},1044:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return h}});var s=a(5893),n=a(1163),l=a(7294),r=a(9263);function i(){let e=(0,n.useRouter)(),t=async()=>{await r.O.auth.signOut(),e.push("/login")};return(0,s.jsx)("button",{onClick:t,className:"fixed top-4 right-4 bg-red-600 text-white px-3 py-1 rounded",children:"Cerrar sesi\xf3n"})}let o=l.forwardRef(function(e,t){let{title:a,titleId:s,...n}=e;return l.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:t,"aria-labelledby":s},n),a?l.createElement("title",{id:s},a):null,l.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.75 19.5 8.25 12l7.5-7.5"}))}),c=l.forwardRef(function(e,t){let{title:a,titleId:s,...n}=e;return l.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:t,"aria-labelledby":s},n),a?l.createElement("title",{id:s},a):null,l.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m8.25 4.5 7.5 7.5-7.5 7.5"}))}),d=l.forwardRef(function(e,t){let{title:a,titleId:s,...n}=e;return l.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:t,"aria-labelledby":s},n),a?l.createElement("title",{id:s},a):null,l.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4.5 10.5 12 3m0 0 7.5 7.5M12 3v18"}))});var u=a(5615);let m=l.forwardRef(function(e,t){let{title:a,titleId:s,...n}=e;return l.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:t,"aria-labelledby":s},n),a?l.createElement("title",{id:s},a):null,l.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19.5 13.5 12 21m0 0-7.5-7.5M12 21V3"}))});var h=()=>{let e=(0,n.useRouter)(),[t,a]=(0,l.useState)(null),[h,x]=(0,l.useState)(!1),[p,g]=(0,l.useState)(()=>{let e=new Date;return"".concat(e.getFullYear(),"-").concat(String(e.getMonth()+1).padStart(2,"0"))}),[f,j]=(0,l.useState)([]),[w,b]=(0,l.useState)(0),[N,y]=(0,l.useState)(0),[v,S]=(0,l.useState)([]),[k,E]=(0,l.useState)(0),[D,O]=(0,l.useState)([]),[L,_]=(0,l.useState)(0),[C,I]=(0,l.useState)({}),[M,R]=(0,l.useState)({}),A=e=>{R(t=>({...t,[e]:!t[e]}))};if((0,l.useEffect)(()=>{(async()=>{let{data:{session:t}}=await r.O.auth.getSession();console.log("\uD83D\uDD0D session from supabase:",t),t?a(!0):e.replace("/mi-app-finanzas/login")})();let{data:t}=r.O.auth.onAuthStateChange((t,a)=>{console.log("\uD83C\uDF00 auth state changed:",a),a||e.replace("/mi-app-finanzas/login")});return()=>{t.subscription.unsubscribe()}},[e]),(0,l.useEffect)(()=>{t&&(async()=>{x(!0);let{data:{session:e}}=await r.O.auth.getSession();if(!e)return;let t=e.user.id;console.log("Usuario:",t);let[a,s]=p.split("-").map(Number),n="".concat(a,"-").concat(String(s).padStart(2,"0"),"-01"),l=new Date(a,s,0).getDate(),i="".concat(a,"-").concat(String(s).padStart(2,"0"),"-").concat(l),{data:o,error:c}=await r.O.from("incomes").select("category:category_id(name),amount").eq("user_id",t).gte("date",n).lte("date",i);if(console.log("Incomes raw:",o,c),!c&&o){let e={};o.forEach(t=>{var a,s,n;let l=t.category,r=Array.isArray(l)?null!==(s=null===(a=l[0])||void 0===a?void 0:a.name)&&void 0!==s?s:"–":null!==(n=null==l?void 0:l.name)&&void 0!==n?n:"–";e[r]=(e[r]||0)+t.amount});let t=e["Devoluci\xf3n"]||0;delete e["Devoluci\xf3n"];let a=Object.entries(e).map(e=>{let[t,a]=e;return{name:t,total:a}}).sort((e,t)=>t.total-e.total);j(a),b(a.reduce((e,t)=>e+t.total,0)),y(t)}let{data:d,error:u}=await r.O.from("transactions").select("category:category_id(name),subcategory:subcategory_id(name),amount,expense_mode").eq("user_id",t).gte("date",n).lte("date",i);if(console.log("Transactions raw:",d,u),!u&&d){let e={},t={},a={};d.forEach(s=>{var n,l,r,i;let o=s.category,c=Array.isArray(o)?null!==(l=null===(n=o[0])||void 0===n?void 0:n.name)&&void 0!==l?l:"–":null!==(r=null==o?void 0:o.name)&&void 0!==r?r:"–";if("fixed"===s.expense_mode)e[c]=(e[c]||0)+s.amount;else{t[c]=(t[c]||0)+s.amount;let e=s.subcategory,n=Array.isArray(e)?null===(i=e[0])||void 0===i?void 0:i.name:null==e?void 0:e.name;n&&(a[c]=a[c]||{},a[c][n]=(a[c][n]||0)+s.amount)}});let s=e=>Object.entries(e).map(e=>{let[t,a]=e;return{name:t,total:a}}).sort((e,t)=>t.total-e.total),n=s(e);S(n),E(n.reduce((e,t)=>e+t.total,0));let l=s(t);O(l),_(l.reduce((e,t)=>e+t.total,0));let r={};Object.entries(a).forEach(e=>{let[t,a]=e;r[t]=s(a)}),I(r)}x(!1)})()},[p,t]),null===t)return null;let F=w-(k+(L-N));return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(i,{}),(0,s.jsx)("main",{className:"p-4 space-y-8",children:h?(0,s.jsx)("p",{children:"Cargando datos..."}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("section",{className:"flex items-center justify-between",children:[(0,s.jsx)(o,{className:"h-6 w-6 cursor-pointer",onClick:()=>{let[e,t]=p.split("-").map(Number),a=new Date(e,t-2,1);g("".concat(a.getFullYear(),"-").concat(String(a.getMonth()+1).padStart(2,"0")))}}),(0,s.jsx)("h2",{className:"text-lg font-semibold",children:p}),(0,s.jsx)(c,{className:"h-6 w-6 cursor-pointer",onClick:()=>{let[e,t]=p.split("-").map(Number),a=new Date(e,t,1);g("".concat(a.getFullYear(),"-").concat(String(a.getMonth()+1).padStart(2,"0")))}})]}),(0,s.jsxs)("section",{className:"bg-white p-4 rounded shadow space-y-2",children:[(0,s.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,s.jsx)(d,{className:"h-5 w-5 text-green-500"}),(0,s.jsx)("h3",{className:"font-medium",children:"Ingresos totales"}),(0,s.jsx)(u.Z,{className:"h-5 w-5 text-gray-400 ml-auto"})]}),(0,s.jsxs)("p",{className:"text-2xl font-bold",children:["$",w.toLocaleString()]}),(0,s.jsxs)("ul",{className:"divide-y",children:[f.map(e=>(0,s.jsxs)("li",{className:"py-1 flex justify-between",children:[(0,s.jsx)("span",{children:e.name}),(0,s.jsxs)("span",{children:["$",e.total.toLocaleString()]})]},e.name)),N>0&&(0,s.jsxs)("li",{className:"py-1 flex justify-between text-red-600",children:[(0,s.jsx)("span",{children:"Devoluciones"}),(0,s.jsxs)("span",{children:["-$",N.toLocaleString()]})]})]})]}),(0,s.jsxs)("section",{className:"bg-white p-4 rounded shadow space-y-2",children:[(0,s.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,s.jsx)(m,{className:"h-5 w-5 text-red-500"}),(0,s.jsx)("h3",{className:"font-medium",children:"Gastos fijos"}),(0,s.jsx)(u.Z,{className:"h-5 w-5 text-gray-400 ml-auto"})]}),(0,s.jsxs)("p",{className:"text-2xl font-bold",children:["$",k.toLocaleString()]}),(0,s.jsx)("ul",{className:"divide-y",children:v.map(e=>(0,s.jsxs)("li",{className:"py-1 flex justify-between",children:[(0,s.jsx)("span",{children:e.name}),(0,s.jsxs)("span",{children:["$",e.total.toLocaleString()]})]},e.name))})]}),(0,s.jsxs)("section",{className:"bg-white p-4 rounded shadow space-y-2",children:[(0,s.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,s.jsx)(m,{className:"h-5 w-5 text-orange-500"}),(0,s.jsx)("h3",{className:"font-medium",children:"Gastos variables"}),(0,s.jsx)(u.Z,{className:"h-5 w-5 text-gray-400 ml-auto"})]}),(0,s.jsxs)("p",{className:"text-2xl font-bold",children:["$",L.toLocaleString()]}),D.map(e=>(0,s.jsxs)("div",{children:[(0,s.jsxs)("button",{onClick:()=>A(e.name),className:"w-full text-left flex justify-between py-1",children:[(0,s.jsx)("span",{children:e.name}),(0,s.jsxs)("span",{children:["$",e.total.toLocaleString()]})]}),M[e.name]&&C[e.name]&&(0,s.jsx)("ul",{className:"pl-4 divide-y",children:C[e.name].map(e=>(0,s.jsxs)("li",{className:"py-1 flex justify-between",children:[(0,s.jsx)("span",{className:"italic",children:e.name}),(0,s.jsxs)("span",{children:["$",e.total.toLocaleString()]})]},e.name))})]},e.name))]}),(0,s.jsxs)("section",{className:"bg-white p-4 rounded shadow space-y-2",children:[(0,s.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,s.jsx)(u.Z,{className:"h-5 w-5 text-blue-500"}),(0,s.jsx)("h3",{className:"font-medium",children:"Balance del mes"})]}),(0,s.jsxs)("p",{className:"text-2xl font-bold ".concat(F<0?"text-red-600":"text-green-600"),children:["$",F.toLocaleString()]})]})]})})]})}}},function(e){e.O(0,[590,888,774,179],function(){return e(e.s=8312)}),_N_E=e.O()}]);