(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[306],{7961:function(e,r,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/incomes",function(){return t(4516)}])},4516:function(e,r,t){"use strict";t.r(r);var a=t(5893),n=t(7294),i=t(9263),s=t(5076);let l=["Ene","Feb","Mar","Abr","May","Jun","Jul","Ago","Sep","Oct","Nov","Dic"],o=e=>new Intl.NumberFormat("es-AR",{minimumFractionDigits:2,maximumFractionDigits:2}).format(e),d=e=>{let r=e.match(/^(\d{4})-(\d{2})/);if(r)return{year:parseInt(r[1],10),month:parseInt(r[2],10)};let t=new Date(e);return{year:t.getFullYear(),month:t.getMonth()+1}};r.default=()=>{var e,r;let[t,c]=(0,n.useState)([]),[u,m]=(0,n.useState)(null),[g,p]=(0,n.useState)(!1),[x,h]=(0,n.useState)(null),[b,f]=(0,n.useState)(!0),y=async()=>{m(null),f(!0);try{let{data:{session:e}}=await i.O.auth.getSession();if(!e){c([]);return}let r=e.user.id,{data:t,error:a}=await i.O.from("incomes").select("\n          id,\n          amount,\n          date,\n          description,\n          category_id,\n          category:category_id(name)\n        ").eq("user_id",r).order("date",{ascending:!1});if(a)console.error(a),m(a.message),c([]);else if(t&&t.length>0){let e=t.map(e=>{var r,t,a,n;let i=e.category,s=Array.isArray(i)?null!==(t=null===(r=i[0])||void 0===r?void 0:r.name)&&void 0!==t?t:"":null!==(a=null==i?void 0:i.name)&&void 0!==a?a:"";return{id:e.id,amount:e.amount,date:e.date,description:e.description,category_id:null!==(n=e.category_id)&&void 0!==n?n:null,category:{name:s}}});c(e)}else c([])}catch(r){var e;console.error(r),m(null!==(e=null==r?void 0:r.message)&&void 0!==e?e:"Error inesperado"),c([])}finally{f(!1)}};(0,n.useEffect)(()=>{y()},[]);let v=n.useMemo(()=>{let e={};return t.forEach(r=>{let{year:t,month:a}=d(r.date),n="".concat(t,"-").concat(a.toString().padStart(2,"0")),i="".concat(l[a-1]," ").concat(t);e[n]||(e[n]={label:i,items:[],total:0}),e[n].items.push(r),e[n].total+=r.amount}),Object.entries(e).sort((e,r)=>e[0]>r[0]?-1:1).map(e=>{let[r,t]=e;return t})},[t]);return(0,a.jsxs)("main",{className:"p-4",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,a.jsx)("h1",{className:"text-2xl font-bold",children:"Ingresos"}),(0,a.jsx)("button",{onClick:()=>{h(null),p(!0)},className:"px-4 py-2 bg-green-500 hover:bg-green-600 text-white rounded-full shadow-sm transition",children:"+ Agregar Ingreso"})]}),b&&(0,a.jsx)("div",{className:"my-6 text-sm text-gray-500",children:"Cargando ingresos…"}),u&&(0,a.jsx)("p",{className:"text-red-600 mb-4",children:u}),!b&&!u&&0===t.length&&(0,a.jsxs)("div",{className:"my-6 rounded border border-dashed border-gray-300 p-6 text-center text-gray-600",children:[(0,a.jsx)("p",{className:"mb-3",children:"Todav\xeda no registraste ingresos."}),(0,a.jsx)("button",{onClick:()=>{h(null),p(!0)},className:"px-4 py-2 bg-green-500 hover:bg-green-600 text-white rounded-full shadow-sm transition",children:"+ Agregar tu primer ingreso"})]}),!b&&!u&&v.map(e=>(0,a.jsxs)("section",{className:"mb-6",children:[(0,a.jsxs)("h2",{className:"text-lg font-semibold mb-2 flex items-center justify-between border-b border-gray-200 pb-1",children:[(0,a.jsx)("span",{children:e.label}),(0,a.jsxs)("span",{className:"text-sm text-gray-600",children:[e.items.length," ",1===e.items.length?"movimiento":"movimientos",(0,a.jsxs)("span",{className:"ml-3 font-semibold text-gray-800",children:["Total: $",o(e.total)]})]})]}),(0,a.jsx)("ul",{className:"bg-white rounded shadow-sm divide-y divide-gray-200",children:e.items.map(e=>(0,a.jsxs)("li",{className:"grid grid-cols-[1fr_auto_auto] gap-2 items-center p-3",children:[(0,a.jsx)("span",{className:"truncate",title:e.description||"",children:e.category.name}),(0,a.jsx)("span",{className:"flex justify-end",children:(0,a.jsxs)("span",{className:"inline-block w-32 text-right font-semibold",children:["$",o(e.amount)]})}),(0,a.jsx)("div",{className:"flex justify-end",children:(0,a.jsx)("button",{onClick:()=>{h(e),p(!0)},className:"px-3 py-1 rounded text-sm bg-gray-200 text-gray-700 hover:bg-gray-300",children:"Editar"})})]},e.id))})]},e.label)),g&&(0,a.jsx)(s.Z,{onClose:()=>p(!1),onSaved:()=>{p(!1),y()},income:x?{id:x.id,amount:x.amount,date:x.date,description:null!==(e=x.description)&&void 0!==e?e:"",category_id:null!==(r=x.category_id)&&void 0!==r?r:null}:null})]})}},5076:function(e,r,t){"use strict";var a=t(5893),n=t(9263),i=t(7294);let s=e=>e.trim().toLowerCase(),l=e=>{let r=new Set,t=[];for(let a of e){let e=s(a.name);r.has(e)||(r.add(e),t.push(a))}return t.sort((e,r)=>e.name.localeCompare(r.name,"es"))},o=e=>Number(String(e).replace(/[^0-9.,-]/g,"").replace(/\.(?=.*,)/g,"").replace(",",".")),d=e=>{let r="number"==typeof e?e:o(e);return isFinite(r)?new Intl.NumberFormat("es-AR",{minimumFractionDigits:2,maximumFractionDigits:2}).format(r):""},c="mf_income_last_category_id";r.Z=function(e){var r,t;let{onClose:u,onSaved:m,initial:g,income:p}=e,x=p?{id:p.id,amount:String(p.amount),date:p.date,description:p.description,category_id:null!==(r=p.category_id)&&void 0!==r?r:void 0}:void 0,h=null!=g?g:x,[b,f]=(0,i.useState)(()=>{let e;if(h)return h;try{let r=localStorage.getItem(c);r&&(e=Number(r))}catch(e){}return{amount:"",date:"",description:"",category_id:e}}),[y,v]=(0,i.useState)([]),[N,j]=(0,i.useState)(!1),[w,_]=(0,i.useState)(""),S=async()=>{let{data:{user:e},error:r}=await n.O.auth.getUser();if(r||!e){console.error("No hay usuario para cargar categor\xedas:",r);return}let{data:t,error:a}=await n.O.from("categories").select("id, name").eq("user_id",e.id).order("name",{ascending:!0});a?console.error("Error cargando categor\xedas:",a):v(l(t||[]))};(0,i.useEffect)(()=>{S()},[]);let E=async()=>{if(!(null==h?void 0:h.id)||!window.confirm("\xbfEst\xe1s seguro de eliminar este ingreso?"))return;let{error:e}=await n.O.from("incomes").delete().eq("id",h.id);e?(console.error(e),alert("Error al eliminar el ingreso")):m()},I=async e=>{let r;e.preventDefault();let{data:{user:t},error:a}=await n.O.auth.getUser();if(a||!t)return console.error("No se pudo obtener el usuario autenticado:",a),alert("Error interno: no hay usuario autenticado");let i=b.category_id;if(N&&w.trim()){let e=w.trim(),r=s(e),{data:a,error:l}=await n.O.from("categories").select("id, name").eq("user_id",t.id).ilike("name",e);if(l)return console.error("Error buscando categor\xeda existente:",l),alert("Error buscando categor\xeda existente");let o=(a||[]).find(e=>s(e.name)===r);if(o)i=o.id;else{let{data:r,error:a}=await n.O.from("categories").insert({name:e,user_id:t.id}).select("id, name").single();if(a||!r)return console.error("Error al crear categor\xeda:",a),alert("Error al crear categor\xeda");i=r.id}await S(),j(!1),_("")}let l={amount:o(b.amount),date:b.date,description:b.description,category_id:i,user_id:t.id};i&&f(e=>({...e,category_id:i})),(null==h?void 0:h.id)?{error:r}=await n.O.from("incomes").update(l).eq("id",h.id):{error:r}=await n.O.from("incomes").insert(l),r?(console.error("Error al guardar ingreso:",r),alert("Error al guardar el ingreso")):m()};return(0,a.jsx)("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:(0,a.jsxs)("div",{className:"bg-white w-full max-w-md max-h-[90vh] rounded-lg overflow-hidden flex flex-col",children:[(0,a.jsx)("div",{className:"px-4 pt-4 pb-2 border-b",children:(0,a.jsx)("h2",{className:"text-lg font-semibold",children:(null==h?void 0:h.id)?"Editar ingreso":"Nuevo ingreso"})}),(0,a.jsx)("div",{className:"flex-1 overflow-auto px-4 py-3",children:(0,a.jsxs)("form",{id:"income-form",onSubmit:I,className:"space-y-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block mb-1",children:"Monto"}),(0,a.jsxs)("div",{className:"flex items-center border rounded px-2",children:[(0,a.jsx)("span",{className:"text-gray-500 mr-2",children:"$"}),(0,a.jsx)("input",{type:"text",inputMode:"decimal",value:b.amount,onChange:e=>{let r=e.target.value.replace(/[^0-9.,-]/g,"");f({...b,amount:r})},onBlur:()=>f(e=>({...e,amount:d(e.amount)})),placeholder:"0,00",className:"w-full py-2 outline-none",required:!0})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block mb-1",children:"Fecha"}),(0,a.jsx)("input",{type:"date",value:b.date,onChange:e=>f({...b,date:e.target.value}),className:"w-full border rounded px-3 py-2",required:!0})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block mb-1",children:"Categor\xeda"}),(0,a.jsxs)("select",{value:N?"__new":null!==(t=b.category_id)&&void 0!==t?t:"",onChange:e=>{if("__new"===e.target.value)j(!0),_(""),f({...b,category_id:void 0});else{let r=Number(e.target.value);j(!1),f({...b,category_id:r});try{localStorage.setItem(c,String(r))}catch(e){}}},className:"w-full border rounded px-3 py-2",children:[(0,a.jsx)("option",{value:"",children:"– Sin categor\xeda –"}),l(y).map(e=>(0,a.jsx)("option",{value:e.id,children:e.name},e.id)),(0,a.jsx)("option",{value:"__new",children:"+ Agregar nueva categor\xeda"})]})]}),N&&(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block mb-1",children:"Nueva categor\xeda"}),(0,a.jsx)("input",{type:"text",value:w,onChange:e=>_(e.target.value),placeholder:"Nombre de nueva categor\xeda",className:"w-full border rounded px-3 py-2",required:!0})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block mb-1",children:"Descripci\xf3n (opcional)"}),(0,a.jsx)("input",{type:"text",value:b.description,onChange:e=>f({...b,description:e.target.value}),placeholder:"Descripci\xf3n",className:"w-full border rounded px-3 py-2"})]})]})}),(0,a.jsxs)("div",{className:"px-4 py-3 border-t bg-white flex gap-2 justify-end",children:[(null==h?void 0:h.id)&&(0,a.jsx)("button",{type:"button",onClick:E,className:"px-3 py-2 border rounded text-red-600",children:"Eliminar"}),(0,a.jsx)("button",{type:"button",onClick:u,className:"px-4 py-2 border rounded",children:"Cancelar"}),(0,a.jsx)("button",{form:"income-form",type:"submit",className:"px-4 py-2 bg-green-600 text-white rounded",children:"Guardar"})]})]})})}},9263:function(e,r,t){"use strict";t.d(r,{O:function(){return s}});var a=t(8590);let n="https://dbuxsnccinjldvxiooye.supabase.co",i="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImRidXhzbmNjaW5qbGR2eGlvb3llIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDk4NTM4NTgsImV4cCI6MjA2NTQyOTg1OH0.Td7-Z8AY9b_EGrbZ_Taxeif0LMkDQ1sQiOL2GU5S5tI";console.log("Supabase URL:",n),console.log("Supabase ANON KEY:",i.slice(0,10)+"…");let s=(0,a.eI)(n,i);console.log("\uD83D\uDEF0️  Supabase Client URL:",n),console.log("\uD83D\uDD11  Supabase Client Key:",i.slice(0,8)+"…")}},function(e){e.O(0,[590,888,774,179],function(){return e(e.s=7961)}),_N_E=e.O()}]);