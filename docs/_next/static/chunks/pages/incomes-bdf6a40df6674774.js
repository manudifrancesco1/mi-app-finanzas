(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[306],{7961:function(e,a,r){(window.__NEXT_P=window.__NEXT_P||[]).push(["/incomes",function(){return r(7383)}])},5076:function(e,a,r){"use strict";var t=r(5893),n=r(9263),s=r(7294);a.Z=function(e){var a;let{onClose:r,onSaved:i,initial:o}=e,[l,d]=(0,s.useState)(o||{amount:"",date:"",description:"",category_id:void 0}),[c,u]=(0,s.useState)([]),[m,g]=(0,s.useState)(!1),[p,x]=(0,s.useState)(""),h=async()=>{let{data:{user:e},error:a}=await n.O.auth.getUser();if(a||!e){console.error("No hay usuario para cargar categor\xedas:",a);return}let{data:r,error:t}=await n.O.from("categories").select("id, name").eq("user_id",e.id).order("name",{ascending:!0});t?console.error("Error cargando categor\xedas:",t):u(r||[])};(0,s.useEffect)(()=>{h()},[]);let f=async()=>{if(!(null==o?void 0:o.id)||!window.confirm("\xbfEst\xe1s seguro de eliminar este ingreso?"))return;let{error:e}=await n.O.from("incomes").delete().eq("id",o.id);e?(console.error(e),alert("Error al eliminar el ingreso")):i()},b=async e=>{let a;e.preventDefault();let{data:{user:r},error:t}=await n.O.auth.getUser();if(t||!r)return console.error("No se pudo obtener el usuario autenticado:",t),alert("Error interno: no hay usuario autenticado");let s=l.category_id;if(m&&p.trim()){let{error:e}=await n.O.from("categories").insert({name:p.trim(),user_id:r.id});if(e)return console.error("Error al crear categor\xeda:",e),alert("Error al crear categor\xeda");await h();let a=c.find(e=>e.name===p.trim());a?s=a.id:console.warn("Categor\xeda creada pero no encontrada en recarga")}let d={amount:parseFloat(l.amount),date:l.date,description:l.description,category_id:s,user_id:r.id};(null==o?void 0:o.id)?{error:a}=await n.O.from("incomes").update(d).eq("id",o.id):{error:a}=await n.O.from("incomes").insert(d),a?(console.error("Error al guardar ingreso:",a),alert("Error al guardar el ingreso")):i()};return(0,t.jsx)("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:(0,t.jsxs)("div",{className:"bg-white p-6 rounded-lg w-full max-w-md",children:[(0,t.jsx)("h2",{className:"text-xl font-semibold mb-4",children:(null==o?void 0:o.id)?"Editar ingreso":"Nuevo ingreso"}),(0,t.jsxs)("form",{onSubmit:b,className:"space-y-4",children:[(0,t.jsx)("input",{type:"number",step:"0.01",value:l.amount,onChange:e=>d({...l,amount:e.target.value}),placeholder:"Monto",className:"w-full border rounded px-3 py-2",required:!0}),(0,t.jsx)("input",{type:"date",value:l.date,onChange:e=>d({...l,date:e.target.value}),className:"w-full border rounded px-3 py-2",required:!0}),(0,t.jsxs)("select",{value:m?"__new":null!==(a=l.category_id)&&void 0!==a?a:"",onChange:e=>{"__new"===e.target.value?(g(!0),x(""),d({...l,category_id:void 0})):(g(!1),d({...l,category_id:Number(e.target.value)}))},className:"w-full border rounded px-3 py-2",children:[(0,t.jsx)("option",{value:"",children:"– Sin categor\xeda –"}),c.map(e=>(0,t.jsx)("option",{value:e.id,children:e.name},e.id)),(0,t.jsx)("option",{value:"__new",children:"+ Agregar nueva categor\xeda"})]}),m&&(0,t.jsx)("input",{type:"text",value:p,onChange:e=>x(e.target.value),placeholder:"Nombre de nueva categor\xeda",className:"w-full border rounded px-3 py-2",required:!0}),(0,t.jsx)("input",{type:"text",value:l.description,onChange:e=>d({...l,description:e.target.value}),placeholder:"Descripci\xf3n",className:"w-full border rounded px-3 py-2"}),(0,t.jsxs)("div",{className:"flex justify-between mt-6",children:[(null==o?void 0:o.id)&&(0,t.jsx)("button",{type:"button",onClick:f,className:"text-red-600 hover:underline",children:"Eliminar"}),(0,t.jsxs)("div",{className:"flex gap-2 ml-auto",children:[(0,t.jsx)("button",{type:"button",onClick:r,className:"px-4 py-2 rounded bg-gray-200 hover:bg-gray-300",children:"Cancelar"}),(0,t.jsx)("button",{type:"submit",className:"px-4 py-2 rounded bg-green-600 text-white hover:bg-green-700",children:"Guardar"})]})]})]})]})})}},9263:function(e,a,r){"use strict";r.d(a,{O:function(){return i}});var t=r(8590);let n="https://dbuxsnccinjldvxiooye.supabase.co",s="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImRidXhzbmNjaW5qbGR2eGlvb3llIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDk4NTM4NTgsImV4cCI6MjA2NTQyOTg1OH0.Td7-Z8AY9b_EGrbZ_Taxeif0LMkDQ1sQiOL2GU5S5tI";console.log("Supabase URL:",n),console.log("Supabase ANON KEY:",s.slice(0,10)+"…");let i=(0,t.eI)(n,s);console.log("\uD83D\uDEF0️  Supabase Client URL:",n),console.log("\uD83D\uDD11  Supabase Client Key:",s.slice(0,8)+"…")},7383:function(e,a,r){"use strict";r.r(a);var t=r(5893),n=r(7294),s=r(9263),i=r(5076);a.default=()=>{let[e,a]=(0,n.useState)([]),[r,o]=(0,n.useState)(null),[l,d]=(0,n.useState)(!1),c=async()=>{o(null);let{data:{session:e}}=await s.O.auth.getSession();if(!e)return;let r=e.user.id,{data:t,error:n}=await s.O.from("incomes").select("\n        id,\n        amount,\n        date,\n        description,\n        category:category_id(name)\n      ").eq("user_id",r).order("date",{ascending:!1});n?(console.error(n),o(n.message)):t&&a(t.map(e=>{var a,r,t;let n=e.category,s=Array.isArray(n)?null!==(r=null===(a=n[0])||void 0===a?void 0:a.name)&&void 0!==r?r:"":null!==(t=null==n?void 0:n.name)&&void 0!==t?t:"";return{id:e.id,amount:e.amount,date:e.date,description:e.description,category:{name:s}}}))};return(0,n.useEffect)(()=>{c()},[]),(0,t.jsxs)("main",{className:"p-4",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,t.jsx)("h1",{className:"text-2xl font-bold",children:"Ingresos"}),(0,t.jsx)("button",{onClick:()=>d(!0),className:"px-4 py-2 bg-green-500 hover:bg-green-600 text-white rounded-full shadow-sm transition",children:"+ Agregar Ingreso"})]}),r&&(0,t.jsx)("p",{className:"text-red-600 mb-4",children:r}),(0,t.jsx)("ul",{className:"space-y-2",children:e.map(e=>(0,t.jsxs)("li",{className:"flex justify-between p-3 bg-white rounded shadow-sm",children:[(0,t.jsx)("span",{className:"w-24",children:e.date}),(0,t.jsx)("span",{className:"flex-1",children:e.category.name}),(0,t.jsx)("span",{className:"flex-1",children:e.description||"-"}),(0,t.jsxs)("span",{className:"w-24 text-right",children:["$",e.amount.toFixed(2)]})]},e.id))}),l&&(0,t.jsx)(i.Z,{onClose:()=>d(!1),onSaved:()=>{d(!1),c()}})]})}}},function(e){e.O(0,[590,888,774,179],function(){return e(e.s=7961)}),_N_E=e.O()}]);