(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[405],{8312:function(e,t,a){(window.__NEXT_P=window.__NEXT_P||[]).push(["/",function(){return a(1044)}])},5076:function(e,t,a){"use strict";var r=a(5893),n=a(9263),s=a(7294);t.Z=function(e){var t;let{onClose:a,onSaved:l,initial:o}=e,[i,c]=(0,s.useState)(o||{amount:"",date:"",description:"",category_id:void 0}),[d,u]=(0,s.useState)([]),[m,x]=(0,s.useState)(!1),[g,h]=(0,s.useState)(""),p=async()=>{let{data:{user:e},error:t}=await n.O.auth.getUser();if(t||!e){console.error("No hay usuario para cargar categor\xedas:",t);return}let{data:a,error:r}=await n.O.from("categories").select("id, name").eq("user_id",e.id).order("name",{ascending:!0});r?console.error("Error cargando categor\xedas:",r):u(a||[])};(0,s.useEffect)(()=>{p()},[]);let f=async()=>{if(!(null==o?void 0:o.id)||!window.confirm("\xbfEst\xe1s seguro de eliminar este ingreso?"))return;let{error:e}=await n.O.from("incomes").delete().eq("id",o.id);e?(console.error(e),alert("Error al eliminar el ingreso")):l()},w=async e=>{let t;e.preventDefault();let{data:{user:a},error:r}=await n.O.auth.getUser();if(r||!a)return console.error("No se pudo obtener el usuario autenticado:",r),alert("Error interno: no hay usuario autenticado");let s=i.category_id;if(m&&g.trim()){let{error:e}=await n.O.from("categories").insert({name:g.trim(),user_id:a.id});if(e)return console.error("Error al crear categor\xeda:",e),alert("Error al crear categor\xeda");await p();let t=d.find(e=>e.name===g.trim());t?s=t.id:console.warn("Categor\xeda creada pero no encontrada en recarga")}let c={amount:parseFloat(i.amount),date:i.date,description:i.description,category_id:s,user_id:a.id};(null==o?void 0:o.id)?{error:t}=await n.O.from("incomes").update(c).eq("id",o.id):{error:t}=await n.O.from("incomes").insert(c),t?(console.error("Error al guardar ingreso:",t),alert("Error al guardar el ingreso")):l()};return(0,r.jsx)("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:(0,r.jsxs)("div",{className:"bg-white p-6 rounded-lg w-full max-w-md",children:[(0,r.jsx)("h2",{className:"text-xl font-semibold mb-4",children:(null==o?void 0:o.id)?"Editar ingreso":"Nuevo ingreso"}),(0,r.jsxs)("form",{onSubmit:w,className:"space-y-4",children:[(0,r.jsx)("input",{type:"number",step:"0.01",value:i.amount,onChange:e=>c({...i,amount:e.target.value}),placeholder:"Monto",className:"w-full border rounded px-3 py-2",required:!0}),(0,r.jsx)("input",{type:"date",value:i.date,onChange:e=>c({...i,date:e.target.value}),className:"w-full border rounded px-3 py-2",required:!0}),(0,r.jsxs)("select",{value:m?"__new":null!==(t=i.category_id)&&void 0!==t?t:"",onChange:e=>{"__new"===e.target.value?(x(!0),h(""),c({...i,category_id:void 0})):(x(!1),c({...i,category_id:Number(e.target.value)}))},className:"w-full border rounded px-3 py-2",children:[(0,r.jsx)("option",{value:"",children:"– Sin categor\xeda –"}),d.map(e=>(0,r.jsx)("option",{value:e.id,children:e.name},e.id)),(0,r.jsx)("option",{value:"__new",children:"+ Agregar nueva categor\xeda"})]}),m&&(0,r.jsx)("input",{type:"text",value:g,onChange:e=>h(e.target.value),placeholder:"Nombre de nueva categor\xeda",className:"w-full border rounded px-3 py-2",required:!0}),(0,r.jsx)("input",{type:"text",value:i.description,onChange:e=>c({...i,description:e.target.value}),placeholder:"Descripci\xf3n",className:"w-full border rounded px-3 py-2"}),(0,r.jsxs)("div",{className:"flex justify-between mt-6",children:[(null==o?void 0:o.id)&&(0,r.jsx)("button",{type:"button",onClick:f,className:"text-red-600 hover:underline",children:"Eliminar"}),(0,r.jsxs)("div",{className:"flex gap-2 ml-auto",children:[(0,r.jsx)("button",{type:"button",onClick:a,className:"px-4 py-2 rounded bg-gray-200 hover:bg-gray-300",children:"Cancelar"}),(0,r.jsx)("button",{type:"submit",className:"px-4 py-2 rounded bg-green-600 text-white hover:bg-green-700",children:"Guardar"})]})]})]})]})})}},1044:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return h}});var r=a(5893),n=a(1163),s=a(7294),l=a(9263);function o(){let e=(0,n.useRouter)(),t=async()=>{await l.O.auth.signOut(),e.push("/login")};return(0,r.jsx)("button",{onClick:t,className:"fixed top-4 right-4 bg-red-600 text-white px-3 py-1 rounded",children:"Cerrar sesi\xf3n"})}var i=a(8078),c=a(5076);let d=s.forwardRef(function(e,t){let{title:a,titleId:r,...n}=e;return s.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:t,"aria-labelledby":r},n),a?s.createElement("title",{id:r},a):null,s.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.75 19.5 8.25 12l7.5-7.5"}))}),u=s.forwardRef(function(e,t){let{title:a,titleId:r,...n}=e;return s.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:t,"aria-labelledby":r},n),a?s.createElement("title",{id:r},a):null,s.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m8.25 4.5 7.5 7.5-7.5 7.5"}))}),m=s.forwardRef(function(e,t){let{title:a,titleId:r,...n}=e;return s.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:t,"aria-labelledby":r},n),a?s.createElement("title",{id:r},a):null,s.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4.5 10.5 12 3m0 0 7.5 7.5M12 3v18"}))}),x=s.forwardRef(function(e,t){let{title:a,titleId:r,...n}=e;return s.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:t,"aria-labelledby":r},n),a?s.createElement("title",{id:r},a):null,s.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19.5 13.5 12 21m0 0-7.5-7.5M12 21V3"}))});var g=a(5615),h=()=>{let e=(0,n.useRouter)(),[t,a]=(0,s.useState)(null),[h,p]=(0,s.useState)(!1),[f,w]=(0,s.useState)(()=>{let e=new Date;return"".concat(e.getFullYear(),"-").concat(String(e.getMonth()+1).padStart(2,"0"))}),[j,b]=(0,s.useState)([]),[v,y]=(0,s.useState)(0),[N,S]=(0,s.useState)(0),[_,E]=(0,s.useState)([]),[k,C]=(0,s.useState)(0),[O,L]=(0,s.useState)([]),[D,M]=(0,s.useState)(0),[$,q]=(0,s.useState)({}),[A,F]=(0,s.useState)({}),[R,B]=(0,s.useState)(!1),[G,W]=(0,s.useState)(!1),Z=e=>F(t=>({...t,[e]:!t[e]}));if((0,s.useEffect)(()=>{(async()=>{let{data:{session:t}}=await l.O.auth.getSession();t?a(!0):e.replace("/login")})();let{data:t}=l.O.auth.onAuthStateChange((t,a)=>{a||e.replace("/login")});return()=>t.subscription.unsubscribe()},[e]),(0,s.useEffect)(()=>{t&&(async()=>{p(!0);let{data:{session:e}}=await l.O.auth.getSession();if(!e)return;let t=e.user.id,[a,r]=f.split("-").map(Number),n="".concat(a,"-").concat(String(r).padStart(2,"0"),"-01"),s=new Date(a,r,0).getDate(),o="".concat(a,"-").concat(String(r).padStart(2,"0"),"-").concat(s),{data:i}=await l.O.from("incomes").select("category:category_id(name),amount").eq("user_id",t).gte("date",n).lte("date",o),c={};null==i||i.forEach(e=>{var t;let a=e.category,r=Array.isArray(a)?null===(t=a[0])||void 0===t?void 0:t.name:null==a?void 0:a.name;c[r||"–"]=(c[r||"–"]||0)+e.amount});let d=c["Devoluci\xf3n"]||0;delete c["Devoluci\xf3n"];let u=Object.entries(c).map(e=>{let[t,a]=e;return{name:t,total:a}});b(u),y(u.reduce((e,t)=>e+t.total,0)),S(d);let{data:m}=await l.O.from("transactions").select("category:category_id(name),subcategory:subcategory_id(name),amount,expense_mode").eq("user_id",t).gte("date",n).lte("date",o),x={},g={},h={};null==m||m.forEach(e=>{var t,a,r;let n=Array.isArray(e.category)?null===(t=e.category[0])||void 0===t?void 0:t.name:null===(a=e.category)||void 0===a?void 0:a.name;if("fixed"===e.expense_mode)x[n]=(x[n]||0)+e.amount;else{g[n]=(g[n]||0)+e.amount;let t=e.subcategory,a=Array.isArray(t)?null===(r=t[0])||void 0===r?void 0:r.name:null==t?void 0:t.name;a&&(h[n]=h[n]||{},h[n][a]=(h[n][a]||0)+e.amount)}});let w=e=>Object.entries(e).map(e=>{let[t,a]=e;return{name:t,total:a}}),j=w(x);E(j),C(j.reduce((e,t)=>e+t.total,0));let v=w(g);L(v),M(v.reduce((e,t)=>e+t.total,0));let N={};Object.entries(h).forEach(e=>{let[t,a]=e;return N[t]=w(a)}),q(N),p(!1)})()},[f,t]),null===t)return null;let Y=v-(k+(D-N));return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(o,{}),(0,r.jsxs)("div",{className:"flex flex-wrap items-center justify-center space-x-4 my-4",children:[(0,r.jsx)(d,{className:"h-6 w-6 cursor-pointer text-gray-600",onClick:()=>{let[e,t]=f.split("-").map(Number),a=new Date(e,t-2,1);w("".concat(a.getFullYear(),"-").concat(String(a.getMonth()+1).padStart(2,"0")))}}),(0,r.jsx)("span",{className:"text-lg font-semibold",children:f}),(0,r.jsx)(u,{className:"h-6 w-6 cursor-pointer text-gray-600",onClick:()=>{let[e,t]=f.split("-").map(Number),a=new Date(e,t,1);w("".concat(a.getFullYear(),"-").concat(String(a.getMonth()+1).padStart(2,"0")))}}),(0,r.jsx)("button",{onClick:()=>B(!0),className:"ml-4 px-3 py-1 rounded-full bg-red-500 text-white text-sm shadow-sm hover:bg-red-600 transition",children:"+ Nuevo Gasto"}),(0,r.jsx)("button",{onClick:()=>W(!0),className:"px-3 py-1 rounded-full bg-green-500 text-white text-sm shadow-sm hover:bg-green-600 transition",children:"+ Nuevo Ingreso"})]}),R&&(0,r.jsx)(i.Z,{onClose:()=>B(!1),onSaved:()=>{B(!1)}}),G&&(0,r.jsx)(c.Z,{onClose:()=>W(!1),onSaved:()=>{W(!1)}}),(0,r.jsxs)("main",{className:"p-4 grid gap-4 grid-cols-1 sm:grid-cols-2 lg:grid-cols-3",children:[(0,r.jsxs)("section",{className:"bg-white rounded-2xl shadow-md p-6 flex flex-col",children:[(0,r.jsxs)("header",{className:"flex items-center mb-4",children:[(0,r.jsx)(m,{className:"h-6 w-6 text-green-500 mr-2"}),(0,r.jsx)("h3",{className:"text-lg font-semibold",children:"Ingresos"})]}),(0,r.jsxs)("p",{className:"text-3xl font-bold mb-4",children:["$",v.toLocaleString()]}),(0,r.jsxs)("ul",{className:"divide-y flex-1 space-y-1 overflow-auto",children:[j.map(e=>(0,r.jsxs)("li",{className:"py-1 flex justify-between text-sm",children:[(0,r.jsx)("span",{children:e.name}),(0,r.jsxs)("span",{children:["$",e.total.toLocaleString()]})]},e.name)),N>0&&(0,r.jsxs)("li",{className:"py-1 flex justify-between text-sm text-red-600",children:[(0,r.jsx)("span",{children:"Devoluciones"}),(0,r.jsxs)("span",{children:["-$",N.toLocaleString()]})]})]})]}),(0,r.jsxs)("section",{className:"bg-white rounded-2xl shadow-md p-6 flex flex-col",children:[(0,r.jsxs)("header",{className:"flex items-center mb-4",children:[(0,r.jsx)(x,{className:"h-6 w-6 text-red-500 mr-2"}),(0,r.jsx)("h3",{className:"text-lg font-semibold",children:"Gastos Fijos"})]}),(0,r.jsxs)("p",{className:"text-3xl font-bold mb-4",children:["$",k.toLocaleString()]}),(0,r.jsx)("ul",{className:"divide-y flex-1 space-y-1 overflow-auto",children:_.map(e=>(0,r.jsxs)("li",{className:"py-1 flex justify-between text-sm",children:[(0,r.jsx)("span",{children:e.name}),(0,r.jsxs)("span",{children:["$",e.total.toLocaleString()]})]},e.name))})]}),(0,r.jsxs)("section",{className:"bg-white rounded-2xl shadow-md p-6 flex flex-col",children:[(0,r.jsxs)("header",{className:"flex items-center mb-4",children:[(0,r.jsx)(x,{className:"h-6 w-6 text-orange-500 mr-2"}),(0,r.jsx)("h3",{className:"text-lg font-semibold",children:"Gastos Variables"})]}),(0,r.jsxs)("p",{className:"text-3xl font-bold mb-4",children:["$",D.toLocaleString()]}),(0,r.jsx)("ul",{className:"space-y-1 flex-1 overflow-auto",children:O.map(e=>(0,r.jsxs)("li",{children:[(0,r.jsxs)("button",{onClick:()=>Z(e.name),className:"w-full flex justify-between text-sm py-1",children:[(0,r.jsx)("span",{children:e.name}),(0,r.jsxs)("span",{children:["$",e.total.toLocaleString()]})]}),A[e.name]&&$[e.name]&&(0,r.jsx)("ul",{className:"pl-4 space-y-1",children:$[e.name].map(e=>(0,r.jsxs)("li",{className:"flex justify-between text-xs py-1",children:[(0,r.jsx)("span",{className:"italic",children:e.name}),(0,r.jsxs)("span",{children:["$",e.total.toLocaleString()]})]},e.name))})]},e.name))})]}),(0,r.jsxs)("section",{className:"bg-white rounded-2xl shadow-md p-6 flex flex-col sm:col-span-2 lg:col-span-1",children:[(0,r.jsxs)("header",{className:"flex items-center mb-4",children:[(0,r.jsx)(g.Z,{className:"h-6 w-6 text-blue-500 mr-2"}),(0,r.jsx)("h3",{className:"text-lg font-semibold",children:"Balance"})]}),(0,r.jsxs)("p",{className:"text-4xl font-bold ".concat(Y<0?"text-red-600":"text-green-600"),children:["$",Y.toLocaleString()]})]})]})]})}}},function(e){e.O(0,[590,78,888,774,179],function(){return e(e.s=8312)}),_N_E=e.O()}]);