"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[962],{3962:function(e,t,a){a.d(t,{Z:function(){return m}});var r=a(5893),l=a(7294),o=a(9263);let n=e=>e.trim().toLowerCase(),i=e=>{let t=new Set,a=[];for(let r of e){let e=n(r.name);t.has(e)||(t.add(e),a.push(r))}return a.sort((e,t)=>e.name.localeCompare(t.name,"es"))},s=e=>Number(String(e).replace(/[^0-9.,-]/g,"").replace(/\.(?=.*,)/g,"").replace(",",".")),c=e=>{let t="number"==typeof e?e:s(e);return isFinite(t)?new Intl.NumberFormat("es-AR",{minimumFractionDigits:2,maximumFractionDigits:2}).format(t):""},d="mf_last_payment_type",u="mf_last_category_id";function m(e){var t,a,m,p,b,y,g;let{initial:x,onClose:f,onSaved:h,onDelete:v}=e,[N,_]=(0,l.useState)([]),[j,w]=(0,l.useState)([]),[C,S]=(0,l.useState)(!1),[k,E]=(0,l.useState)(!1),[I,O]=(0,l.useState)(""),[D,L]=(0,l.useState)(!1),[M,q]=(0,l.useState)(""),F=(0,l.useMemo)(()=>{try{return localStorage.getItem(d)||"debito"}catch(e){return"debito"}},[]),J=(0,l.useMemo)(()=>{try{let e=localStorage.getItem(u);return e?Number(e):null}catch(e){return null}},[]),[R,T]=(0,l.useState)({id:null==x?void 0:x.id,amount:null!==(t=null==x?void 0:x.amount)&&void 0!==t?t:"",date:null!==(a=null==x?void 0:x.date)&&void 0!==a?a:"",description:null!==(m=null==x?void 0:x.description)&&void 0!==m?m:"",category_id:null!==(b=null!==(p=null==x?void 0:x.category_id)&&void 0!==p?p:J)&&void 0!==b?b:null,subcategory_id:null!==(y=null==x?void 0:x.subcategory_id)&&void 0!==y?y:null,payment_type:null!==(g=null==x?void 0:x.payment_type)&&void 0!==g?g:F,new_category:"",new_subcategory:""}),G=!!R.id,Z=(0,l.useRef)(null);async function z(){let{data:{session:e}}=await o.O.auth.getSession();if(!e){_([]);return}let{data:t,error:a}=await o.O.from("categories").select("id, name").eq("user_id",e.user.id).order("name",{ascending:!0});a?(console.error(a),_([])):_(i(t||[]))}async function A(e){if(!e){w([]);return}let{data:t,error:a}=await o.O.from("subcategories").select("id, name, category_id").eq("category_id",e).order("name",{ascending:!0});a?(console.error(a),w([])):w(i((t||[]).map(e=>({id:e.id,name:e.name}))))}async function Q(e){var t;e.preventDefault(),S(!0);let{data:{session:a}}=await o.O.auth.getSession();if(!a){alert("No est\xe1s autenticado"),S(!1);return}let r=a.user,l=R.category_id;if(k&&I.trim()){let e=I.trim(),t=n(e),{data:a,error:i}=await o.O.from("categories").select("id, name").eq("user_id",r.id).ilike("name",e);if(i){console.error("Error buscando categor\xeda existente:",i),alert("Error buscando categor\xeda existente"),S(!1);return}let s=(a||[]).find(e=>n(e.name)===t);if(s)l=s.id;else{let{data:t,error:a}=await o.O.from("categories").insert({name:e,user_id:r.id}).select("id, name").single();if(a||!t){console.error("Error al crear categor\xeda:",a),alert("Error al crear categor\xeda"),S(!1);return}l=t.id}await z(),E(!1),O("")}let i=null!==(t=R.subcategory_id)&&void 0!==t?t:null;if(D&&M.trim()&&l){let e=M.trim(),{data:t,error:a}=await o.O.from("subcategories").select("id, name, category_id").eq("category_id",l).ilike("name",e);if(a){console.error("Error buscando subcategor\xeda existente:",a),alert("Error buscando subcategor\xeda existente"),S(!1);return}let r=(t||[]).find(t=>n(t.name)===n(e));if(r)i=r.id;else{let{data:t,error:a}=await o.O.from("subcategories").insert({name:e,category_id:l}).select("id, name").single();if(a||!t){console.error("Error al crear subcategor\xeda:",a),alert("Error al crear subcategor\xeda"),S(!1);return}i=t.id}await A(l),L(!1),q("")}let c={user_id:r.id,amount:s(R.amount||"0"),date:R.date,description:R.description,category_id:l,subcategory_id:i,expense_mode:"variable",payment_type:R.payment_type||null};if(!l){alert("Seleccion\xe1 una categor\xeda"),S(!1);return}if(R.id){let{error:e}=await o.O.from("transactions").update(c).eq("id",R.id);if(e){console.error(e),alert("Error al actualizar gasto"),S(!1);return}}else{let{error:e}=await o.O.from("transactions").insert(c);if(e){console.error(e),alert("Error al crear gasto"),S(!1);return}}h(),f(),S(!1)}async function U(){if(!R.id)return;let{error:e}=await o.O.from("transactions").delete().eq("id",R.id);if(e){console.error(e),alert("No se pudo eliminar el gasto");return}null==v||v()}(0,l.useEffect)(()=>{var e;null===(e=Z.current)||void 0===e||e.focus()},[]),(0,l.useEffect)(()=>{z()},[]),(0,l.useEffect)(()=>{if(A(R.category_id||null),L(!1),q(""),T(e=>({...e,subcategory_id:null})),R.category_id)try{localStorage.setItem(u,String(R.category_id))}catch(e){}},[R.category_id]),(0,l.useEffect)(()=>{let e=e=>{"c"===e.key.toLowerCase()&&T(e=>({...e,payment_type:"credito"})),"d"===e.key.toLowerCase()&&T(e=>({...e,payment_type:"debito"}))};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[]),(0,l.useEffect)(()=>{try{R.payment_type&&localStorage.setItem(d,R.payment_type)}catch(e){}},[R.payment_type]);let X=(0,l.useMemo)(()=>i(N),[N]),Y=(0,l.useMemo)(()=>i(j),[j]);return(0,r.jsx)("form",{onSubmit:Q,className:"p-0 sm:p-4 w-full h-full",children:(0,r.jsxs)("div",{className:"flex flex-col h-full max-h-[90vh] sm:max-h-none",children:[(0,r.jsx)("div",{className:"px-4 pt-4 pb-2 sm:pt-0",children:(0,r.jsx)("h2",{className:"text-lg font-semibold",children:G?"Editar gasto":"Nuevo gasto variable"})}),(0,r.jsxs)("div",{className:"flex-1 overflow-auto px-4 pb-24 sm:pb-4",children:[(0,r.jsxs)("div",{className:"mb-3",children:[(0,r.jsx)("label",{className:"block mb-1",children:"Tipo de pago"}),(0,r.jsxs)("div",{className:"flex gap-2",children:[(0,r.jsx)("button",{type:"button","aria-pressed":"credito"===R.payment_type,className:"px-4 py-2 rounded-full border text-sm ".concat("credito"===R.payment_type?"bg-violet-600 text-white border-violet-600":"bg-gray-100 text-gray-800 border-gray-300"),onClick:()=>T(e=>({...e,payment_type:"credito"})),children:"Cr\xe9dito"}),(0,r.jsx)("button",{type:"button","aria-pressed":"debito"===R.payment_type,className:"px-4 py-2 rounded-full border text-sm ".concat("debito"===R.payment_type?"bg-emerald-600 text-white border-emerald-600":"bg-gray-100 text-gray-800 border-gray-300"),onClick:()=>T(e=>({...e,payment_type:"debito"})),children:"D\xe9bito"})]})]}),(0,r.jsxs)("div",{className:"mb-3",children:[(0,r.jsx)("label",{className:"block mb-1",children:"Monto"}),(0,r.jsxs)("div",{className:"flex items-center border rounded px-2",children:[(0,r.jsx)("span",{className:"text-gray-500 mr-2",children:"$"}),(0,r.jsx)("input",{ref:Z,type:"text",inputMode:"decimal",value:R.amount,onChange:e=>{let t=e.target.value.replace(/[^0-9.,-]/g,"");T({...R,amount:t})},onBlur:()=>T(e=>({...e,amount:c(e.amount)})),placeholder:"0,00",className:"w-full py-2 outline-none",required:!0})]})]}),(0,r.jsxs)("div",{className:"mb-3",children:[(0,r.jsx)("label",{className:"block mb-1",children:"Categor\xeda"}),k?(0,r.jsxs)("div",{children:[(0,r.jsx)("input",{type:"text",value:I,onChange:e=>O(e.target.value),className:"w-full border rounded px-2 py-2 mb-2",placeholder:"Nombre de la nueva categor\xeda"}),(0,r.jsx)("button",{type:"button",onClick:()=>E(!1),className:"text-sm text-blue-600",children:"Cancelar"})]}):(0,r.jsxs)("select",{value:R.category_id||"",onChange:e=>"new"===e.target.value?E(!0):T({...R,category_id:e.target.value?Number(e.target.value):null}),className:"w-full border rounded px-2 py-2",children:[(0,r.jsx)("option",{value:"",children:"Buscar o seleccionar…"}),X.map(e=>(0,r.jsx)("option",{value:e.id,children:e.name},e.id)),(0,r.jsx)("option",{value:"new",children:"+ Nueva categor\xeda"})]})]}),(0,r.jsxs)("div",{className:"mb-3",children:[(0,r.jsx)("label",{className:"block mb-1",children:"Subcategor\xeda (opcional)"}),D?(0,r.jsxs)("div",{children:[(0,r.jsx)("input",{type:"text",value:M,onChange:e=>q(e.target.value),className:"w-full border rounded px-2 py-2 mb-2",placeholder:"Nombre de la nueva subcategor\xeda"}),(0,r.jsx)("button",{type:"button",onClick:()=>L(!1),className:"text-sm text-blue-600",children:"Cancelar"})]}):(0,r.jsxs)("div",{className:"flex gap-2",children:[(0,r.jsxs)("select",{value:R.subcategory_id||"",onChange:e=>{let t=e.target.value;T(e=>({...e,subcategory_id:t?Number(t):null}))},className:"w-full border rounded px-2 py-2",disabled:!R.category_id,children:[(0,r.jsx)("option",{value:"",children:"Sin subcategor\xeda"}),Y.map(e=>(0,r.jsx)("option",{value:e.id,children:e.name},e.id))]}),(0,r.jsx)("button",{type:"button",onClick:()=>L(!0),className:"px-3 py-2 text-sm border rounded disabled:opacity-50",disabled:!R.category_id,children:"+ Nueva"})]})]}),(0,r.jsxs)("div",{className:"mb-3",children:[(0,r.jsx)("label",{className:"block mb-1",children:"Fecha"}),(0,r.jsx)("input",{type:"date",value:R.date,onChange:e=>T({...R,date:e.target.value}),required:!0,className:"w-full border rounded px-2 py-2"})]}),(0,r.jsxs)("div",{className:"mb-3",children:[(0,r.jsx)("label",{className:"block mb-1",children:"Descripci\xf3n (opcional)"}),(0,r.jsx)("input",{type:"text",value:R.description,onChange:e=>T({...R,description:e.target.value}),className:"w-full border rounded px-2 py-2"})]})]}),(0,r.jsxs)("div",{className:"px-4 py-3 border-t bg-white sticky bottom-0 flex gap-2 justify-end",children:[G&&(0,r.jsx)("button",{type:"button",onClick:U,className:"px-3 py-2 border rounded text-red-600",children:"Eliminar"}),(0,r.jsx)("button",{type:"button",onClick:f,className:"px-4 py-2 border rounded",children:"Cancelar"}),(0,r.jsx)("button",{type:"submit",disabled:C||!R.amount||!R.date||!R.category_id,className:"px-4 py-2 bg-blue-600 text-white rounded disabled:opacity-50",children:"Guardar"})]})]})})}},9263:function(e,t,a){a.d(t,{O:function(){return n}});var r=a(8590);let l="https://dbuxsnccinjldvxiooye.supabase.co",o="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImRidXhzbmNjaW5qbGR2eGlvb3llIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDk4NTM4NTgsImV4cCI6MjA2NTQyOTg1OH0.Td7-Z8AY9b_EGrbZ_Taxeif0LMkDQ1sQiOL2GU5S5tI";console.log("Supabase URL:",l),console.log("Supabase ANON KEY:",o.slice(0,10)+"…");let n=(0,r.eI)(l,o);console.log("\uD83D\uDEF0️  Supabase Client URL:",l),console.log("\uD83D\uDD11  Supabase Client Key:",o.slice(0,8)+"…")}}]);