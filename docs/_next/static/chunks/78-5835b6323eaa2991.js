"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[78],{8078:function(e,t,a){a.d(t,{Z:function(){return s}});var i=a(5893),n=a(7294),r=a(9263);let l=n.forwardRef(function(e,t){let{title:a,titleId:i,...r}=e;return n.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:t,"aria-labelledby":i},r),a?n.createElement("title",{id:i},a):null,n.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 4.5v15m7.5-7.5h-15"}))});function s(e){var t;let{onClose:a,onSaved:s,initial:o}=e,d=!!(null==o?void 0:o.id),[c,u]=(0,n.useState)((null==o?void 0:o.expense_mode)||"variable"),[m,g]=(0,n.useState)(null),[p,b]=(0,n.useState)([]),[x,y]=(0,n.useState)([]),[h,f]=(0,n.useState)([]),[v,_]=(0,n.useState)(!1),[w,j]=(0,n.useState)(!1),[N,C]=(0,n.useState)(!1),[S,k]=(0,n.useState)({id:null==o?void 0:o.id,category_id:(null==o?void 0:o.category_id)||0,new_category:"",subcategory_id:null!==(t=null==o?void 0:o.subcategory_id)&&void 0!==t?t:null,new_subcategory:"",amount:(null==o?void 0:o.amount)||"",date:(null==o?void 0:o.date)||new Date().toISOString().slice(0,10),description:(null==o?void 0:o.description)||"",tags:(null==o?void 0:o.tags)||"",payment_type:(null==o?void 0:o.payment_type)||"credit",installments:(null==o?void 0:o.installments)||"1",expense_mode:(null==o?void 0:o.expense_mode)||"variable"});(0,n.useEffect)(()=>{(async()=>{let{data:{user:e}}=await r.O.auth.getUser();if(!e)return;let{data:t}=await r.O.from("categories").select("id,name,type,is_fixed").eq("user_id",e.id).eq("type","expense").order("name"),a=t||[];b(a),y(a.filter(e=>!e.is_fixed).slice(0,5))})()},[]),(0,n.useEffect)(()=>{if(!S.category_id){f([]);return}(async()=>{let{data:{user:e}}=await r.O.auth.getUser();if(!e)return;let{data:t}=await r.O.from("subcategories").select("id,name").eq("user_id",e.id).eq("category_id",S.category_id).order("name");f(t||[])})()},[S.category_id]);let O=e=>{let{name:t,value:a,type:i,checked:n}=e.target;k(e=>({...e,[t]:"checkbox"===i?n:a}))},I=async()=>{var e,t,a,i;g(null);let{data:{user:n}}=await r.O.auth.getUser();if(!n){g("Debes iniciar sesi\xf3n");return}let l=S.category_id;if(v&&(null===(e=S.new_category)||void 0===e?void 0:e.trim())){let{data:e,error:t}=await r.O.from("categories").insert({user_id:n.id,name:S.new_category.trim(),type:"expense",is_fixed:!1}).select("id").limit(1);if(t||!e||0===e.length){g((null==t?void 0:t.message)||"Error al crear categor\xeda");return}l=e[0].id}let o=null!==(i=S.subcategory_id)&&void 0!==i?i:null;if(w&&(null===(t=S.new_subcategory)||void 0===t?void 0:t.trim())){let{data:e,error:t}=await r.O.from("subcategories").insert({user_id:n.id,category_id:l,name:S.new_subcategory.trim()}).select("id").limit(1);if(t||!e||0===e.length){g((null==t?void 0:t.message)||"Error al crear subcategor\xeda");return}o=e[0].id}let c={user_id:n.id,category_id:l,subcategory_id:o,amount:parseFloat(S.amount),date:S.date,description:S.description||null,tags:(null===(a=S.tags)||void 0===a?void 0:a.split(",").map(e=>e.trim()))||[],payment_type:S.payment_type,installments:"credit"===S.payment_type?parseInt(S.installments,10):null,expense_mode:"variable"};if(d){let{error:e}=await r.O.from("transactions").update(c).eq("id",S.id);if(e){g(e.message);return}}else{let{error:e}=await r.O.from("transactions").insert(c);if(e){g(e.message);return}}s()},[E,D]=(0,n.useState)([]),[q,F]=(0,n.useState)({}),[T,U]=(0,n.useState)({}),[G,L]=(0,n.useState)(()=>{let e=new Date;return"".concat(e.getFullYear(),"-").concat(String(e.getMonth()+1).padStart(2,"0"))});(0,n.useEffect)(()=>{(async()=>{g(null);let{data:{user:e}}=await r.O.auth.getUser();if(!e)return;let{data:t,error:a}=await r.O.from("categories").select("id,name").eq("user_id",e.id).eq("is_fixed",!0);if(a){g(a.message);return}let i=(t=t||[]).map(e=>e.name),n=["Alquiler","Expensas","Luz","Gas","OSDE","Tarjeta Visa"].filter(e=>!i.includes(e));if(n.length){await r.O.from("categories").insert(n.map(t=>({user_id:e.id,name:t,type:"expense",is_fixed:!0})));let{data:a}=await r.O.from("categories").select("id,name").eq("user_id",e.id).eq("is_fixed",!0);t=a||[]}D(t);let l={},s={};t.forEach(e=>{l[e.id]="",s[e.id]=!1});let[o,d]=G.split("-"),c="".concat(o,"-").concat(d,"-01"),u=new Date(+o,+d,0).getDate(),m="".concat(o,"-").concat(d,"-").concat(String(u).padStart(2,"0")),{data:p,error:b}=await r.O.from("transactions").select("category_id,amount").eq("user_id",e.id).eq("expense_mode","fixed").gte("date",c).lte("date",m);if(b){g(b.message);return}null==p||p.forEach(e=>{l[e.category_id]=e.amount.toString(),s[e.category_id]=!0}),F(l),U(s)})()},[G]);let M=(e,t)=>{F(a=>({...a,[e]:t}))},J=async e=>{g(null);let t=parseFloat(q[e]);if(isNaN(t)||t<=0){g("Ingresa monto v\xe1lido");return}let{data:{user:a}}=await r.O.auth.getUser();if(!a){g("Debes iniciar sesi\xf3n");return}let i="".concat(G,"-01"),{error:n}=await r.O.from("transactions").insert({user_id:a.id,category_id:e,subcategory_id:null,amount:t,date:i,description:null,payment_type:"transfer",installments:null,expense_mode:"fixed"});if(n){g(n.message);return}U(t=>({...t,[e]:!0}))};return(0,i.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-30 flex items-center justify-center px-4",onClick:a,children:(0,i.jsxs)("div",{className:"bg-white rounded-2xl p-6 w-full max-w-md",onClick:e=>e.stopPropagation(),children:[(0,i.jsxs)("div",{className:"flex mb-4 rounded overflow-hidden",children:[(0,i.jsx)("button",{onClick:()=>u("variable"),className:"flex-1 py-2 text-center transition-colors ".concat("variable"===c?"bg-blue-500 text-white":"bg-gray-200 text-gray-700 hover:bg-gray-300"),children:"Variable"}),(0,i.jsx)("button",{onClick:()=>u("fixed"),className:"flex-1 py-2 text-center transition-colors ".concat("fixed"===c?"bg-blue-500 text-white":"bg-gray-200 text-gray-700 hover:bg-gray-300"),children:"Fijo"})]}),"fixed"===c?(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)("h2",{className:"text-lg font-medium mb-3",children:"Pagos fijos"}),m&&(0,i.jsx)("p",{className:"text-red-500 mb-2",children:m}),(0,i.jsxs)("div",{className:"mb-4",children:[(0,i.jsx)("label",{className:"block mb-1",children:"Mes:"}),(0,i.jsx)("input",{type:"month",value:G,onChange:e=>L(e.target.value),className:"w-full border p-2 rounded"})]}),(0,i.jsx)("ul",{className:"space-y-4 mb-4",children:E.map(e=>(0,i.jsxs)("li",{className:"flex items-center gap-3 p-2 rounded ".concat(T[e.id]?"bg-green-100":""),children:[(0,i.jsx)("span",{className:"w-1/2",children:e.name}),(0,i.jsx)("input",{type:"number",min:"0",step:"0.01",placeholder:"0.00",value:q[e.id],onChange:t=>M(e.id,t.target.value),disabled:T[e.id],className:"flex-1 border p-2 rounded text-right"}),(0,i.jsx)("button",{onClick:()=>J(e.id),disabled:T[e.id],className:"px-3 py-1 rounded ".concat(T[e.id]?"bg-green-500 text-white":"bg-blue-500 text-white hover:bg-blue-600"),children:T[e.id]?"✓":"Agregar"})]},e.id))}),(0,i.jsx)("div",{className:"flex justify-end",children:(0,i.jsx)("button",{onClick:a,className:"px-4 py-2 bg-gray-200 rounded",children:"Cerrar"})})]}):(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)("h2",{className:"text-lg font-medium mb-4",children:d?"Editar gasto":"Nuevo gasto"}),m&&(0,i.jsx)("p",{className:"text-red-500 mb-2",children:m}),(0,i.jsxs)("div",{className:"flex overflow-x-auto gap-2 mb-3",children:[x.map(e=>(0,i.jsx)("button",{onClick:()=>{k(t=>({...t,category_id:e.id})),_(!1)},className:"px-3 py-1 rounded-full whitespace-nowrap ".concat(S.category_id===e.id?"bg-blue-500 text-white":"bg-gray-200 text-gray-700"),children:e.name},e.id)),(0,i.jsx)("button",{onClick:()=>_(e=>!e),className:"px-3 py-1 rounded-full bg-green-500 text-white",children:(0,i.jsx)(l,{className:"h-5 w-5"})})]}),v?(0,i.jsx)("input",{name:"new_category",type:"text",placeholder:"Nombre categor\xeda",value:S.new_category,onChange:O,className:"w-full border p-2 rounded mb-3"}):(0,i.jsxs)("select",{name:"category_id",value:S.category_id,onChange:O,className:"w-full border p-2 rounded mb-3",children:[(0,i.jsx)("option",{value:0,children:"-- Selecciona categor\xeda --"}),p.map(e=>(0,i.jsx)("option",{value:e.id,children:e.name},e.id))]}),(0,i.jsxs)("div",{className:"relative mb-3",children:[(0,i.jsx)("button",{onClick:()=>j(e=>!e),className:"absolute top-0 right-0 bg-yellow-500 text-white rounded-full p-1 z-10",title:"Nueva subcategor\xeda",children:(0,i.jsx)(l,{className:"h-4 w-4"})}),w?(0,i.jsx)("input",{name:"new_subcategory",type:"text",placeholder:"Nombre subcategor\xeda",value:S.new_subcategory,onChange:O,className:"w-full border p-2 rounded"}):h.length>0?(0,i.jsxs)("select",{name:"subcategory_id",value:S.subcategory_id||0,onChange:O,className:"w-full border p-2 rounded",children:[(0,i.jsx)("option",{value:0,children:"-- Selecciona subcategor\xeda --"}),h.map(e=>(0,i.jsx)("option",{value:e.id,children:e.name},e.id))]}):(0,i.jsx)("p",{className:"text-gray-500",children:"Selecciona categor\xeda primero"})]}),(0,i.jsx)("div",{className:"flex gap-2 mb-3",children:["credit","debit","transfer"].map(e=>(0,i.jsx)("button",{onClick:()=>k(t=>({...t,payment_type:e})),className:"flex-1 py-2 rounded ".concat(S.payment_type===e?"bg-blue-500 text-white":"bg-gray-200 text-gray-700"),children:"credit"===e?"Cr\xe9dito":"debit"===e?"D\xe9bito":"Transferencia"},e))}),"credit"===S.payment_type&&(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)("div",{className:"flex gap-2 mb-3",children:[[1,3,6,12].map(e=>(0,i.jsx)("button",{onClick:()=>k(t=>({...t,installments:String(e)})),className:"px-3 py-1 rounded-full ".concat(S.installments===String(e)?"bg-blue-500 text-white":"bg-gray-200 text-gray-700"),children:e},e)),(0,i.jsx)("button",{onClick:()=>C(!0),className:"px-3 py-1 rounded-full bg-gray-200 text-gray-700",children:"+"})]}),(N||!["1","3","6","12"].includes(S.installments))&&(0,i.jsx)("input",{name:"installments",type:"number",min:"1",placeholder:"Cuotas",value:S.installments,onChange:O,className:"w-full border p-2 rounded mb-3"})]}),(0,i.jsx)("input",{name:"amount",type:"number",placeholder:"Monto",value:S.amount,onChange:O,className:"w-full border p-2 rounded mb-3"}),(0,i.jsx)("input",{name:"date",type:"date",value:S.date,onChange:O,className:"w-full border p-2 rounded mb-3"}),(0,i.jsx)("input",{name:"description",type:"text",placeholder:"Descripci\xf3n (opcional)",value:S.description,onChange:O,className:"w-full border p-2 rounded mb-3"}),(0,i.jsx)("input",{name:"tags",type:"text",placeholder:"Tags (separa con comas)",value:S.tags,onChange:O,className:"w-full border p-2 rounded mb-4"}),(0,i.jsxs)("div",{className:"flex justify-end space-x-2",children:[(0,i.jsx)("button",{onClick:a,className:"px-4 py-2 bg-gray-200 rounded",children:"Cancelar"}),(0,i.jsx)("button",{onClick:I,className:"px-4 py-2 bg-blue-500 text-white rounded",children:d?"Guardar cambios":"Guardar"})]})]})]})})}},9263:function(e,t,a){a.d(t,{O:function(){return l}});var i=a(8590);let n="https://dbuxsnccinjldvxiooye.supabase.co",r="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImRidXhzbmNjaW5qbGR2eGlvb3llIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDk4NTM4NTgsImV4cCI6MjA2NTQyOTg1OH0.Td7-Z8AY9b_EGrbZ_Taxeif0LMkDQ1sQiOL2GU5S5tI";console.log("Supabase URL:",n),console.log("Supabase ANON KEY:",r.slice(0,10)+"…");let l=(0,i.eI)(n,r);console.log("\uD83D\uDEF0️  Supabase Client URL:",n),console.log("\uD83D\uDD11  Supabase Client Key:",r.slice(0,8)+"…")}}]);