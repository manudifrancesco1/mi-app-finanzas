(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[405],{8312:function(e,t,a){(window.__NEXT_P=window.__NEXT_P||[]).push(["/",function(){return a(8130)}])},9263:function(e,t,a){"use strict";a.d(t,{O:function(){return l}});var n=a(8590);let u="https://dbuxsnccinjldvxiooye.supabase.co",r="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImRidXhzbmNjaW5qbGR2eGlvb3llIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDk4NTM4NTgsImV4cCI6MjA2NTQyOTg1OH0.Td7-Z8AY9b_EGrbZ_Taxeif0LMkDQ1sQiOL2GU5S5tI";console.log("Supabase URL:",u),console.log("Supabase ANON KEY:",r.slice(0,10)+"…");let l=(0,n.eI)(u,r);console.log("\uD83D\uDEF0️  Supabase Client URL:",u),console.log("\uD83D\uDD11  Supabase Client Key:",r.slice(0,8)+"…")},8130:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return i}});var n=a(5893),u=a(1163),r=a(7294),l=a(9263);function o(){let e=(0,u.useRouter)(),t=async()=>{await l.O.auth.signOut(),e.push("/login")};return(0,n.jsx)("button",{onClick:t,className:"fixed top-4 right-4 bg-red-600 text-white px-3 py-1 rounded",children:"Cerrar sesi\xf3n"})}var i=()=>{let e=(0,u.useRouter)(),[t,a]=(0,r.useState)(null),[i,s]=(0,r.useState)(()=>{let e=new Date;return"".concat(e.getFullYear(),"-").concat(String(e.getMonth()+1).padStart(2,"0"))}),[c,d]=(0,r.useState)([]),[m,p]=(0,r.useState)(0),[g,f]=(0,r.useState)(0),[b,S]=(0,r.useState)([]),[y,h]=(0,r.useState)(0),[v,_]=(0,r.useState)([]),[O,I]=(0,r.useState)(0),[N,w]=(0,r.useState)({}),[D,E]=(0,r.useState)({});return((0,r.useEffect)(()=>{(async()=>{let{data:{session:t}}=await l.O.auth.getSession();t?a(!0):e.replace("/mi-app-finanzas/login")})();let{data:t}=l.O.auth.onAuthStateChange((t,a)=>{a||e.replace("/mi-app-finanzas/login")});return()=>{t.subscription.unsubscribe()}},[e]),(0,r.useEffect)(()=>{t&&(async()=>{let{data:{session:e}}=await l.O.auth.getSession();if(!e)return;let t=e.user.id,[a,n]=i.split("-").map(Number),u="".concat(a,"-").concat(String(n).padStart(2,"0"),"-01"),r=new Date(a,n,0).getDate(),o="".concat(a,"-").concat(String(n).padStart(2,"0"),"-").concat(r),{data:s,error:c}=await l.O.from("incomes").select("category:category_id(name),amount").eq("user_id",t).gte("date",u).lte("date",o);if(!c&&s){let e={};s.forEach(t=>{var a,n,u;let r=t.category,l=Array.isArray(r)?null!==(n=null===(a=r[0])||void 0===a?void 0:a.name)&&void 0!==n?n:"–":null!==(u=null==r?void 0:r.name)&&void 0!==u?u:"–";e[l]=(e[l]||0)+t.amount});let t=e["Devoluci\xf3n"]||0;delete e["Devoluci\xf3n"];let a=Object.entries(e).map(e=>{let[t,a]=e;return{name:t,total:a}}).sort((e,t)=>t.total-e.total);d(a),p(a.reduce((e,t)=>e+t.total,0)),f(t)}let{data:m,error:g}=await l.O.from("transactions").select("category:category_id(name),subcategory:subcategory_id(name),amount,expense_mode").eq("user_id",t).gte("date",u).lte("date",o);if(!g&&m){let e={},t={},a={};m.forEach(n=>{var u,r,l,o;let i=n.category,s=Array.isArray(i)?null!==(r=null===(u=i[0])||void 0===u?void 0:u.name)&&void 0!==r?r:"–":null!==(l=null==i?void 0:i.name)&&void 0!==l?l:"–";if("fixed"===n.expense_mode)e[s]=(e[s]||0)+n.amount;else{t[s]=(t[s]||0)+n.amount;let e=n.subcategory,u=Array.isArray(e)?null===(o=e[0])||void 0===o?void 0:o.name:null==e?void 0:e.name;u&&(a[s]=a[s]||{},a[s][u]=(a[s][u]||0)+n.amount)}});let n=e=>Object.entries(e).map(e=>{let[t,a]=e;return{name:t,total:a}}).sort((e,t)=>t.total-e.total),u=n(e);S(u),h(u.reduce((e,t)=>e+t.total,0));let r=n(t);_(r),I(r.reduce((e,t)=>e+t.total,0));let l={};Object.entries(a).forEach(e=>{let[t,a]=e;l[t]=n(a)}),w(l)}})()},[i,t]),null===t)?null:(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(o,{}),(0,n.jsx)("main",{className:"p-4 space-y-8"})]})}}},function(e){e.O(0,[590,888,774,179],function(){return e(e.s=8312)}),_N_E=e.O()}]);