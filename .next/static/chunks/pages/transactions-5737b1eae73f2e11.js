(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[673],{28:function(e,t,a){(window.__NEXT_P=window.__NEXT_P||[]).push(["/transactions",function(){return a(1860)}])},9263:function(e,t,a){"use strict";a.d(t,{O:function(){return i}});var n=a(8590);let s="https://dbuxsnccinjldvxiooye.supabase.co",l="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImRidXhzbmNjaW5qbGR2eGlvb3llIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDk4NTM4NTgsImV4cCI6MjA2NTQyOTg1OH0.Td7-Z8AY9b_EGrbZ_Taxeif0LMkDQ1sQiOL2GU5S5tI";console.log("Supabase URL:",s),console.log("Supabase ANON KEY:",l.slice(0,10)+"…");let i=(0,n.eI)(s,l);console.log("\uD83D\uDEF0️  Supabase Client URL:",s),console.log("\uD83D\uDD11  Supabase Client Key:",l.slice(0,8)+"…")},1860:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return d}});var n=a(5893),s=a(7294),l=a(9263),i=a(1163);function d(){var e;let t=(0,i.useRouter)(),[a,d]=(0,s.useState)([]),[o,r]=(0,s.useState)([]),[c,m]=(0,s.useState)([]),[u,p]=(0,s.useState)({category_id:0,amount:"",date:"",description:"",tags:"",payment_method_id:0,installments_total:""}),[g,h]=(0,s.useState)(null);(0,s.useEffect)(()=>{(async()=>{let{data:e}=await l.O.from("categories").select("id, name, type").order("name",{ascending:!0});e&&d(e);let{data:t}=await l.O.from("payment_methods").select("id, label, type").order("label",{ascending:!0});t&&r(t)})()},[]);let _=async()=>{let{data:e,error:t}=await l.O.from("transactions").select("\n        id,\n        amount,\n        currency,\n        date,\n        description,\n        tags,\n        installments_total,\n        installments_paid,\n        method:payment_methods ( label ),\n        category:categories ( id, name, type )\n      ").order("date",{ascending:!1});t?h(t.message):e&&m(e.map(e=>{var t,a,n,s;return{id:e.id,amount:Number(e.amount),currency:e.currency,date:e.date.slice(0,10),description:e.description,tags:e.tags,category_id:e.category.id,category_name:e.category.name,type:e.category.type,payment_method_label:null!==(a=null===(t=e.method)||void 0===t?void 0:t.label)&&void 0!==a?a:"—",installments_total:null!==(n=e.installments_total)&&void 0!==n?n:null,installments_paid:null!==(s=e.installments_paid)&&void 0!==s?s:null}}))};(0,s.useEffect)(()=>{_()},[]);let y=e=>{p({...u,[e.target.name]:e.target.value})},b=async()=>{var e;h(null);let{data:{user:t}}=await l.O.auth.getUser();if(!t){h("Debes iniciar sesi\xf3n");return}let a=(null===(e=o.find(e=>e.id===Number(u.payment_method_id)))||void 0===e?void 0:e.type)==="credit",n={user_id:t.id,category_id:u.category_id,amount:parseFloat(u.amount),date:u.date,description:u.description||null,tags:u.tags?u.tags.split(",").map(e=>e.trim()):[],payment_method_id:u.payment_method_id||null};a?(n.recurrence="installment",n.installments_total=parseInt(u.installments_total)||1,n.installments_paid=1):(n.recurrence="one-off",n.installments_total=null,n.installments_paid=null);let{error:s}=await l.O.from("transactions").insert(n);s?h(s.message):(p({category_id:0,amount:"",date:"",description:"",tags:"",payment_method_id:0,installments_total:""}),_())};return(0,n.jsxs)("div",{className:"min-h-screen bg-gray-50 p-6",children:[(0,n.jsxs)("div",{className:"flex gap-4 mb-6",children:[(0,n.jsx)("button",{onClick:()=>t.push("/"),className:"text-blue-600 hover:underline",children:"← Dashboard"}),(0,n.jsx)("button",{onClick:()=>t.push("/categories"),className:"text-blue-600 hover:underline",children:"← Categor\xedas"})]}),(0,n.jsx)("h1",{className:"text-2xl font-semibold mb-4",children:"Mis Transacciones"}),g&&(0,n.jsx)("p",{className:"text-red-500 mb-2",children:g}),(0,n.jsxs)("div",{className:"bg-white p-4 rounded-xl shadow-ios mb-6 grid grid-cols-1 md:grid-cols-6 gap-2",children:[(0,n.jsxs)("select",{name:"category_id",value:u.category_id,onChange:y,className:"border p-2 rounded col-span-2",children:[(0,n.jsx)("option",{value:0,children:"-- Elige categor\xeda --"}),a.map(e=>(0,n.jsxs)("option",{value:e.id,children:[e.name," (",e.type,")"]},e.id))]}),(0,n.jsx)("input",{name:"amount",type:"number",placeholder:"Monto",value:u.amount,onChange:y,className:"border p-2 rounded"}),(0,n.jsx)("input",{name:"date",type:"date",value:u.date,onChange:y,className:"border p-2 rounded"}),(0,n.jsxs)("select",{name:"payment_method_id",value:u.payment_method_id,onChange:y,className:"border p-2 rounded col-span-1",children:[(0,n.jsx)("option",{value:0,children:"-- M\xe9todo --"}),o.map(e=>(0,n.jsx)("option",{value:e.id,children:e.label},e.id))]}),(null===(e=o.find(e=>e.id===Number(u.payment_method_id)))||void 0===e?void 0:e.type)==="credit"&&(0,n.jsx)("input",{name:"installments_total",type:"number",placeholder:"Cuotas",value:u.installments_total,onChange:y,className:"border p-2 rounded col-span-1"}),(0,n.jsx)("button",{onClick:b,className:"bg-blue-500 text-white py-2 rounded-xl hover:bg-blue-600 transition col-span-1",children:"Agregar"})]}),(0,n.jsx)("div",{className:"space-y-3",children:c.map(e=>(0,n.jsxs)("div",{className:"bg-white p-4 rounded-2xl shadow-ios flex justify-between items-center",children:[(0,n.jsxs)("div",{children:[(0,n.jsxs)("div",{className:"font-medium",children:[e.category_name," — ",e.payment_method_label," (",e.type,")"]}),(0,n.jsxs)("div",{className:"text-gray-600",children:[e.date," — ",e.description||"—"]})]}),(0,n.jsxs)("div",{className:"text-right",children:[(0,n.jsxs)("div",{className:"expense"===e.type?"text-red-500":"text-green-500",children:[e.amount.toLocaleString()," ",e.currency]}),e.installments_total&&(0,n.jsxs)("div",{className:"text-sm text-gray-500",children:[e.installments_paid,"/",e.installments_total," cuotas"]}),e.tags.length>0&&(0,n.jsx)("div",{className:"text-sm text-gray-500",children:e.tags.join(", ")})]})]},e.id))})]})}}},function(e){e.O(0,[590,888,774,179],function(){return e(e.s=28)}),_N_E=e.O()}]);